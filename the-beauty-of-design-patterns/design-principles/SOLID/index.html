<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SOLID | READING NOTES</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/reading-notes/favicon.ico">
    <link rel="manifest" href="/reading-notes/manifest.webmanifest" crossorigin="use-credentials">
    <meta name="description" content="写点啦!">
    <meta property="og:url" content="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID.html">
    <meta property="og:site_name" content="READING NOTES">
    <meta property="og:title" content="SOLID">
    <meta property="og:description" content="SOLID 设计原则是指导我们代码设计的一些经验总结。对是否应用某种设计模式具有指导意义。设计原则有个非常大的特点，那就是这些特点听起来都比较抽象，定义描述都比较模糊，不同的人会有不同解读。 接下来，学习一些经典设计原则，其中包括 SOLID、KISS、YAGNI、DRY、LOD 等，介绍这些原则的定义，原则设计的初衷，能解决哪些问题，有哪些应用场景等。 S">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="READING NOTES">
    <meta name="theme-color" content="#46bd87">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <link rel="preload" href="/reading-notes/assets/css/0.styles.d0bc5918.css" as="style"><link rel="preload" href="/reading-notes/assets/js/app.e6a9f205.js" as="script"><link rel="preload" href="/reading-notes/assets/js/vendors~layout-Layout.5a15940e.js" as="script"><link rel="preload" href="/reading-notes/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.7c754536.js" as="script"><link rel="preload" href="/reading-notes/assets/js/page-SOLID.774414f8.js" as="script"><link rel="preload" href="/reading-notes/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.3cdde019.js" as="script"><link rel="preload" href="/reading-notes/assets/js/37.5a75d47b.js" as="script"><link rel="prefetch" href="/reading-notes/assets/js/3.f5cc4994.js"><link rel="prefetch" href="/reading-notes/assets/js/38.ab82d4b4.js"><link rel="prefetch" href="/reading-notes/assets/js/layout-Blog.619a14d8.js"><link rel="prefetch" href="/reading-notes/assets/js/layout-Layout.ea688dcf.js"><link rel="prefetch" href="/reading-notes/assets/js/layout-NotFound.de88c5f3.js"><link rel="prefetch" href="/reading-notes/assets/js/layout-Slide.24e7e7cb.js"><link rel="prefetch" href="/reading-notes/assets/js/page--3992e0e1.d49ab92a.js"><link rel="prefetch" href="/reading-notes/assets/js/page--44a0de64.487467af.js"><link rel="prefetch" href="/reading-notes/assets/js/page--5f87f751.b750d627.js"><link rel="prefetch" href="/reading-notes/assets/js/page--7507ab0e.b6579281.js"><link rel="prefetch" href="/reading-notes/assets/js/page--ac2b465e.8b47f4ac.js"><link rel="prefetch" href="/reading-notes/assets/js/page--d1e0c466.b2332822.js"><link rel="prefetch" href="/reading-notes/assets/js/page-DRY原则.61301bc4.js"><link rel="prefetch" href="/reading-notes/assets/js/page-KISS.35e13008.js"><link rel="prefetch" href="/reading-notes/assets/js/page-LOD.19aa49ff.js"><link rel="prefetch" href="/reading-notes/assets/js/page-YAGNI.83d2d66a.js"><link rel="prefetch" href="/reading-notes/assets/js/page-专业主义.b7f51522.js"><link rel="prefetch" href="/reading-notes/assets/js/page-为什么要用金字塔原理.a6515cba.js"><link rel="prefetch" href="/reading-notes/assets/js/page-为什么需要学习掌握设计模式相关知识.a7f76ed9.js"><link rel="prefetch" href="/reading-notes/assets/js/page-了解架构设计.1a5bc9e5.js"><link rel="prefetch" href="/reading-notes/assets/js/page-从0开始学架构.8991210d.js"><link rel="prefetch" href="/reading-notes/assets/js/page-代码整洁之道-程序员的职业素养.52fb2188.js"><link rel="prefetch" href="/reading-notes/assets/js/page-前言.eb873ccd.js"><link rel="prefetch" href="/reading-notes/assets/js/page-实战.aec7368d.js"><link rel="prefetch" href="/reading-notes/assets/js/page-硅谷钢铁侠.259f4fff.js"><link rel="prefetch" href="/reading-notes/assets/js/page-系统复杂度的来源.dadf2416.js"><link rel="prefetch" href="/reading-notes/assets/js/page-说不.7f866a23.js"><link rel="prefetch" href="/reading-notes/assets/js/page-说是.45f443d1.js"><link rel="prefetch" href="/reading-notes/assets/js/page-重构.61d7a2c3.js"><link rel="prefetch" href="/reading-notes/assets/js/page-金字塔原理.a0b47183.js"><link rel="prefetch" href="/reading-notes/assets/js/page-面向对象是什么.c3ee4b9b.js"><link rel="prefetch" href="/reading-notes/assets/js/vendors~photo-swipe.8bb0dc2b.js">
    <link rel="stylesheet" href="/reading-notes/assets/css/0.styles.d0bc5918.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/reading-notes/" class="home-link router-link-active"><!----> <!----> <span class="site-name can-hide">READING NOTES</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">Theme Color:</label> <li><span class="default-theme"></span></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">Theme Mode:</label> <div class="darkmode-switch"><div class="item day"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon light-icon"><path d="M512 256a42.667 42.667 0 0 0 42.667-42.667V128a42.667 42.667 0 0 0-85.334 0v85.333A42.667 42.667 0 0 0 512 256zm384 213.333h-85.333a42.667 42.667 0 0 0 0 85.334H896a42.667 42.667 0 0 0 0-85.334zM256 512a42.667 42.667 0 0 0-42.667-42.667H128a42.667 42.667 0 0 0 0 85.334h85.333A42.667 42.667 0 0 0 256 512zm9.387-298.667a42.667 42.667 0 0 0-59.307 62.72l61.44 59.307a42.667 42.667 0 0 0 31.147 11.947 42.667 42.667 0 0 0 30.72-13.227 42.667 42.667 0 0 0 0-60.16zm459.946 133.974a42.667 42.667 0 0 0 29.44-11.947l61.44-59.307a42.667 42.667 0 0 0-57.6-62.72l-61.44 60.587a42.667 42.667 0 0 0 0 60.16 42.667 42.667 0 0 0 28.16 13.227zM512 768a42.667 42.667 0 0 0-42.667 42.667V896a42.667 42.667 0 0 0 85.334 0v-85.333A42.667 42.667 0 0 0 512 768zm244.48-79.36a42.667 42.667 0 0 0-59.307 61.44l61.44 60.587a42.667 42.667 0 0 0 29.44 11.946 42.667 42.667 0 0 0 30.72-12.8 42.667 42.667 0 0 0 0-60.586zm-488.96 0-61.44 59.307a42.667 42.667 0 0 0 0 60.586 42.667 42.667 0 0 0 30.72 12.8 42.667 42.667 0 0 0 28.587-10.666l61.44-59.307a42.667 42.667 0 0 0-59.307-61.44zM512 341.333A170.667 170.667 0 1 0 682.667 512 170.667 170.667 0 0 0 512 341.333z" fill="currentColor"></path></svg></div> <div class="item auto active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon auto-icon"><path d="M460.864 539.072H564.8L510.592 376l-49.728 163.072zM872 362.368V149.504H659.648L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352V661.376l149.12-149.504L872 362.368zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624h-85.888l144.576-407.68h90.368l144.576 407.68h-85.824zm0 0" fill="currentColor"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon dark-icon"><path d="M935.539 630.402c-11.43-11.432-28.674-14.739-43.531-8.354-46.734 20.103-96.363 30.297-147.508 30.297-99.59 0-193.221-38.784-263.64-109.203-108.637-108.637-139.61-270.022-78.908-411.148a39.497 39.497 0 0 0-51.886-51.887c-52.637 22.64-100.017 54.81-140.826 95.616-85.346 85.346-132.346 198.821-132.346 319.52 0 120.7 47.001 234.172 132.347 319.519S408.063 947.11 528.76 947.11c120.7 0 234.172-47.003 319.52-132.351 40.809-40.81 72.978-88.19 95.616-140.826a39.497 39.497 0 0 0-8.356-43.532z" fill="currentColor"></path></svg></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="目录" class="dropdown-title"><span class="title"><!---->
        目录
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>🧑🏻‍💻 技术</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/reading-notes/the-beauty-of-design-patterns/" class="nav-link router-link-active active"><!---->
  设计模式之美
</a></li><li class="dropdown-subitem"><a href="/reading-notes/learn-architecture-from-zero/" class="nav-link"><!---->
  从0开始学架构
</a></li><li class="dropdown-subitem"><a href="/reading-notes/the-clean-coder/" class="nav-link"><!---->
  代码整洁之道|程序员的职业素养
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>🎯 综合能力</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/reading-notes/the-minto-pyramid-principle/" class="nav-link"><!---->
  金字塔原理
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>🥤 人物传记</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/reading-notes/elon-musk/" class="nav-link"><!---->
  硅谷钢铁侠
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://niexia.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  个人博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div></nav> <!----> <a rel="noopener noreferrer" href="https://github.com/niexia/reading-notes" target="_blank" class="repo-link can-hide">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!----> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="目录" class="dropdown-title"><span class="title"><!---->
      目录
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>🧑🏻‍💻 技术</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/reading-notes/the-beauty-of-design-patterns/" class="nav-link router-link-active active"><!---->
  设计模式之美
</a></li><li class="dropdown-subitem"><a href="/reading-notes/learn-architecture-from-zero/" class="nav-link"><!---->
  从0开始学架构
</a></li><li class="dropdown-subitem"><a href="/reading-notes/the-clean-coder/" class="nav-link"><!---->
  代码整洁之道|程序员的职业素养
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>🎯 综合能力</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/reading-notes/the-minto-pyramid-principle/" class="nav-link"><!---->
  金字塔原理
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>🥤 人物传记</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/reading-notes/elon-musk/" class="nav-link"><!---->
  硅谷钢铁侠
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://niexia.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  个人博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a rel="noopener noreferrer" href="https://github.com/niexia/reading-notes" target="_blank" class="repo-link">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <!----> <div class="content__sidebar-center"></div> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><!----> <span class="title">面向对象</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/reading-notes/the-beauty-of-design-patterns/object-oriented/what-is-object-oriented/" class="sidebar-link">面向对象是什么</a></li><li><a href="/reading-notes/the-beauty-of-design-patterns/object-oriented/practice/" class="sidebar-link">实战</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><!----> <span class="title">设计原则</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/" aria-current="page" class="active sidebar-link">SOLID</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#单一职责原则-single-responsibility-principle" class="sidebar-link">单一职责原则 Single Responsibility Principle</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#如何理解单一指责原则" class="sidebar-link heading3">如何理解单一指责原则</a></li><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#怎么判断职责是否单一" class="sidebar-link heading3">怎么判断职责是否单一</a></li><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#类的职责是否设计越单一越好" class="sidebar-link heading3">类的职责是否设计越单一越好</a></li></ul></li><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#开闭原则-open-closed-principle" class="sidebar-link">开闭原则 Open Closed Principle</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#如何理解-对扩展开发、修改关闭" class="sidebar-link heading3">如何理解“对扩展开发、修改关闭”</a></li><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#修改代码就意味着违背开闭原则吗" class="sidebar-link heading3">修改代码就意味着违背开闭原则吗</a></li><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#如何做到-对扩展开放、修改关闭" class="sidebar-link heading3">如何做到“对扩展开放、修改关闭”</a></li><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#如何在项目中灵活应用开闭原则" class="sidebar-link heading3">如何在项目中灵活应用开闭原则</a></li></ul></li><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#里式替换-liskov-substitution-principle" class="sidebar-link">里式替换 Liskov Substitution Principle</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#如何理解-里式替换原则" class="sidebar-link heading3">如何理解“里式替换原则”</a></li><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#哪些代码明显违背了-lsp" class="sidebar-link heading3">哪些代码明显违背了 LSP</a></li></ul></li><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#接口隔离原则-interface-segregation-principle" class="sidebar-link">接口隔离原则 Interface Segregation Principle</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#如何理解-接口隔离原则" class="sidebar-link heading3">如何理解“接口隔离原则”</a></li><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#把-接口-理解为一组-api-接口集合" class="sidebar-link heading3">把“接口”理解为一组 API 接口集合</a></li><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#把-接口-理解为单个-api-接口或函数" class="sidebar-link heading3">把“接口”理解为单个 API 接口或函数</a></li><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#把-接口-理解为-oop-中的接口概念" class="sidebar-link heading3">把“接口”理解为 OOP 中的接口概念</a></li></ul></li><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#依赖反转原则-dependency-inversion-principle" class="sidebar-link">依赖反转原则 Dependency Inversion Principle</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#控制反转-ioc" class="sidebar-link heading3">控制反转（IOC）</a></li><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#依赖注入-di" class="sidebar-link heading3">依赖注入（DI）</a></li><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#依赖注入框架-di-framework" class="sidebar-link heading3">依赖注入框架（DI Framework）</a></li><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#依赖反转原则-dip" class="sidebar-link heading3">依赖反转原则（DIP）</a></li></ul></li></ul></li><li><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/KISS/" class="sidebar-link">KISS</a></li><li><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/YAGNI/" class="sidebar-link">YAGNI</a></li><li><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/DRY/" class="sidebar-link">DRY原则</a></li><li><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/LOD/" class="sidebar-link">LOD</a></li><li><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/practice/" class="sidebar-link">/the-beauty-of-design-patterns/design-principles/practice/</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><!----> <span class="title">规范与重构</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/reading-notes/the-beauty-of-design-patterns/standard-refactor/refactor/" class="sidebar-link">重构</a></li><li><a href="/reading-notes/the-beauty-of-design-patterns/standard-refactor/standard/" class="sidebar-link">/the-beauty-of-design-patterns/standard-refactor/standard/</a></li><li><a href="/reading-notes/the-beauty-of-design-patterns/standard-refactor/practice/" class="sidebar-link">/the-beauty-of-design-patterns/standard-refactor/practice/</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><!----> <span class="title">设计模式</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><!----></li></ul></section></li></ul> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb"><ol vocab="https://schema.org/" typeof="BreadcrumbList"><li property="itemListElement" typeof="ListItem"><a href="/reading-notes/the-beauty-of-design-patterns/" property="item" typeof="WebPage" class="router-link-active"><!----> <span property="name">为什么需要学习掌握设计模式相关知识</span></a> <meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem" class="is-active"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/" aria-current="page" property="item" typeof="WebPage" class="router-link-exact-active router-link-active"><!----> <span property="name">SOLID</span></a> <meta property="position" content="2"></li></ol></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">SOLID</span></h1> <div class="page-info"><!----> <!----><!----><span aria-label="Writing Date📅" data-balloon-pos="down" class="time-info"><svg viewBox="0 0 1030 1024" xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H180.6A134.314 134.314 0 0 0 46.66 277.595v535.756A134.314 134.314 0 0 0 180.6 947.289h669.74a134.36 134.36 0 0 0 133.94-133.938V277.595a134.314 134.314 0 0 0-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 0 1-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 0 1-33.472 33.473z" fill="currentColor"></path></svg> <span property="datePublished">2022-4-5</span></span><!----><!----><span aria-label="Reading Time⌛" data-balloon-pos="down" class="reading-time-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon timer-icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z" fill="currentColor"></path></svg> <span>About 31 min</span> <meta property="timeRequired" content="PT31M"></span></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#单一职责原则-single-responsibility-principle" class="anchor-link heading2"><div>单一职责原则 Single Responsibility Principle</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#如何理解单一指责原则" class="anchor-link heading3"><div>如何理解单一指责原则</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#怎么判断职责是否单一" class="anchor-link heading3"><div>怎么判断职责是否单一</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#类的职责是否设计越单一越好" class="anchor-link heading3"><div>类的职责是否设计越单一越好</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#开闭原则-open-closed-principle" class="anchor-link heading2"><div>开闭原则 Open Closed Principle</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#如何理解-对扩展开发、修改关闭" class="anchor-link heading3"><div>如何理解“对扩展开发、修改关闭”</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#修改代码就意味着违背开闭原则吗" class="anchor-link heading3"><div>修改代码就意味着违背开闭原则吗</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#如何做到-对扩展开放、修改关闭" class="anchor-link heading3"><div>如何做到“对扩展开放、修改关闭”</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#如何在项目中灵活应用开闭原则" class="anchor-link heading3"><div>如何在项目中灵活应用开闭原则</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#里式替换-liskov-substitution-principle" class="anchor-link heading2"><div>里式替换 Liskov Substitution Principle</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#如何理解-里式替换原则" class="anchor-link heading3"><div>如何理解“里式替换原则”</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#哪些代码明显违背了-lsp" class="anchor-link heading3"><div>哪些代码明显违背了 LSP</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#接口隔离原则-interface-segregation-principle" class="anchor-link heading2"><div>接口隔离原则 Interface Segregation Principle</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#如何理解-接口隔离原则" class="anchor-link heading3"><div>如何理解“接口隔离原则”</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#把-接口-理解为一组-api-接口集合" class="anchor-link heading3"><div>把“接口”理解为一组 API 接口集合</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#把-接口-理解为单个-api-接口或函数" class="anchor-link heading3"><div>把“接口”理解为单个 API 接口或函数</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#把-接口-理解为-oop-中的接口概念" class="anchor-link heading3"><div>把“接口”理解为 OOP 中的接口概念</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#依赖反转原则-dependency-inversion-principle" class="anchor-link heading2"><div>依赖反转原则 Dependency Inversion Principle</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#控制反转-ioc" class="anchor-link heading3"><div>控制反转（IOC）</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#依赖注入-di" class="anchor-link heading3"><div>依赖注入（DI）</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#依赖注入框架-di-framework" class="anchor-link heading3"><div>依赖注入框架（DI Framework）</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/#依赖反转原则-dip" class="anchor-link heading3"><div>依赖反转原则（DIP）</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><h1 id="solid"><a href="#solid" class="header-anchor">#</a> SOLID</h1> <p><strong>设计原则是指导我们代码设计的一些经验总结</strong>。对是否应用某种设计模式具有指导意义。设计原则有个非常大的特点，那就是这些特点听起来都比较抽象，定义描述都比较模糊，不同的人会有不同解读。</p> <p>接下来，学习一些经典设计原则，其中包括 SOLID、KISS、YAGNI、DRY、LOD 等，介绍这些原则的定义，<strong>原则设计的初衷，能解决哪些问题，有哪些应用场景等</strong>。</p> <p>SOLID 原则并非单纯的 1 个原则，而是由 5 个设计原则组成的，它们分别是：</p> <ul><li>S：单一职责原则</li> <li>O：开闭原则</li> <li>L：里式替换原则</li> <li>I：接口隔离原则</li> <li>D：依赖反转原则</li></ul> <h2 id="单一职责原则-single-responsibility-principle"><a href="#单一职责原则-single-responsibility-principle" class="header-anchor">#</a> 单一职责原则 Single Responsibility Principle</h2> <h3 id="如何理解单一指责原则"><a href="#如何理解单一指责原则" class="header-anchor">#</a> 如何理解单一指责原则</h3> <p>单一职责原则的英文是 Single Responsibility Principle，缩写为 SRP。这个原则的英文描述是这样的：A class or module should have a single responsibility。如果我们把它翻译成中文，那就是：<strong>一个类或者模块只负责完成一个职责（或者功能）</strong></p> <p>这个原则的描述对象包含两个：<strong>类（class）和模块（module）</strong></p> <p>关于这个概念有两个理解方式：</p> <ul><li>把模块看作是<strong>更加抽象的概念</strong>，类也可以看作模块；</li> <li>把模块看作比类<strong>更粗粒度的代码块</strong>，模块包含多个类，多个类组成一个模块。</li></ul> <p>接下来只从“类”的角度进行分析。</p> <p>单一指责定义很简单，也很好理解。<strong>一个类只负责完成一个职责或功能，也就是说不要设计大而全的类，要设计粒度小、功能单一的类</strong>。如果把两个或两个以上业务不相干的功能放到一个类中，那么我们就可以说它的职责不单一，应该进行拆分。</p> <p>例如一个类包含了订单的一些操作，也包含了用户的一些操作，而订单和用户是两个独立的业务模型，将两个不相干的功能放到一个类中，就违反单一指责原则。</p> <h3 id="怎么判断职责是否单一"><a href="#怎么判断职责是否单一" class="header-anchor">#</a> 怎么判断职责是否单一</h3> <p>虽然有时我们容易看出两个功能是否想干，但是在大部分真实开发中，<strong>对于一个类是否职责单一的判断是很拿捏的</strong>。</p> <p>举个列子，在一个社交商品中，用下面 UserInfo 类来记录用户信息：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">class</span> <span class="token class-name">UserInfo</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> userId<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> username<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> telephone<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> createTime<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> lastLoginTime<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> avatarUrl<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> provinceOfAddress<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">// 省</span>
  <span class="token keyword">private</span> cityOfAddress<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">// 市</span>
  <span class="token keyword">private</span> regionOfAddress<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">// 区 </span>
  <span class="token keyword">private</span> detailedAddress<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">// 详细地址</span>
  <span class="token comment">// ...省略其他属性和方法...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>你觉得它是否满足单一职责原则呢？</p> <p>关于这个问题有两个观点：</p> <p>1.UserInfo 都是跟用户相关的信息，所有属性和方法都隶属于用户这个业务模型，满足单一指责；<br>
2.地址信息在 UserInfo 中占比比较重，可以拆分成独立的 UserAddressInfo 类，拆分之后两个类职责更加单一。</p> <p><strong>做选择的时候不能脱离具体的应用场景</strong>。如果地址信息和其他信息，只是单纯用来展示，那现在 UserInfo 的设计是合理的；如果产品发展很好，之后又添加了电商模块，用户地址信息还会用在电商物流中，那最好是将地址信息从 UserInfo 中拆分出来独立成用户物流信息（或者叫地址信息）</p> <p>从刚刚这里例子可以总结出：</p> <ul><li>不同应用场景、不同阶段的需求背景下，对同一个类的职责是否单一的判断，可能都是不一样。</li> <li>另外从不同业务层面，去看待同一个类的设计，对类是否职责单一，也会有不同的认识。如果从“用户”这个业务层面，UserInfo 包含所有用户满足单一职责原则；从“用户展示信息”、“地址信息”等这些更细粒度的业务层面来看，那 UserInfo 就应该继续拆分。</li></ul> <p>这样看来，<strong>判断一个类的职责是否单一没有一个明确的、可以量化的标准</strong>。这是一件非常主观的事情。</p> <p><strong>在真正的软件开发中，我们没必要过于未雨绸缪，过度设计</strong>。可以先写一个粗粒度的类，满足业务需求。随着业务发展，如果粗粒度的类越来越大，代码越来越多，这个时候我们就可以将这个类，拆分成几个更细粒度的类。这就是所谓的<strong>持续重构</strong>。</p> <h4 id="判断技巧"><a href="#判断技巧" class="header-anchor">#</a> 判断技巧</h4> <p>为了更好拿捏这个原则，这里有些小技巧，能够很好帮你从侧面上判定一个类是否足够单一。比起主观的思考更有指导意义、更有可执行性。</p> <ul><li>类太大：类中的代码行数、函数或属性过多，会影响代码的可读性和可维护性，我们就需要考虑对类进行拆分；</li> <li>类依赖太多（<strong>耦合重</strong>）：类依赖的其他类过多，或者依赖类的其他类过多，不符合高内聚、低耦合的设计思想，我们就需要考虑对类进行拆分；</li> <li>私有方法过多不能复用：私有方法过多，我们就要考虑能否将私有方法独立到新的类中，设置为 public 方法，供更多的类使用，从而提高代码的复用性；</li> <li>很难命名：比较难给类起一个合适名字，很难用一个业务名词概括，或者只能用一些笼统的 Manager、Context 之类的词语来命名，这就说明类的职责定义得可能不够清晰；</li> <li>方法只和少数属性相关：类中大量的方法都是集中操作类中的某几个属性，比如，在 UserInfo 例子中，如果一半的方法都是在操作 address 信息，那就可以考虑将这几个属性和对应的方法拆分出来。</li></ul> <p>不过，上面的判断原则还是“模糊的”，代码函数多少才算多？前期我们约定可以量化的标准，例如代码函数不超过 200 行。随着经验的积累，就可以在开发中慢慢“品尝”出来。就像大厨“放少许盐”。</p> <h3 id="类的职责是否设计越单一越好"><a href="#类的职责是否设计越单一越好" class="header-anchor">#</a> 类的职责是否设计越单一越好</h3> <p>答案是否定的。</p> <p>还是看一个例子，Serialization 类实现了一个简单协议的序列化和反序列功能。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>
<span class="token comment">/**
 * Protocol format: identifier-string;{gson string}
 * For example: UEUEUE;{&quot;a&quot;:&quot;A&quot;,&quot;b&quot;:&quot;B&quot;}
 */</span>
<span class="token keyword">class</span> <span class="token class-name">Serialization</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token constant">IDENTIFIER_STRING</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">&quot;UEUEUE;&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> gson<span class="token punctuation">;</span>
  
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>gson <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> textBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    textBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token constant">IDENTIFIER_STRING</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    textBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>gson<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> textBuilder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">deserialize</span><span class="token punctuation">(</span>text<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>text<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token constant">IDENTIFIER_STRING</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Collections<span class="token punctuation">.</span><span class="token function">emptyMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> gsonStr <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token constant">IDENTIFIER_STRING</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> gson<span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>gsonStr<span class="token punctuation">,</span> Map<span class="token punctuation">.</span>class<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>如果想当职责更加单一，拆分成两个类：一个负责序列化，一个负责反序列化。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">class</span> <span class="token class-name">Serialize</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token constant">IDENTIFIER_STRING</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">&quot;UEUEUE;&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> gson<span class="token punctuation">;</span>
  
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>gson <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Deserializer</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token constant">IDENTIFIER_STRING</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">&quot;UEUEUE;&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> gson<span class="token punctuation">;</span>
  
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>gson <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">deserialize</span><span class="token punctuation">(</span>text<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p><strong>拆分之后职责更单一，但是带来了一些新问题，可维护性更差了</strong>：</p> <ul><li>不内聚：如果我们需要修改协议格式（JSON =&gt; XML），那么两个类都需要修改</li> <li>容易修改漏：如果修改的时候只改了 Serialize，忘记修改 Deserializer 就导致序列化、反序列化不匹配出错</li></ul> <p class="nx-tip warning">
  实际上，不管是应用设计原则还是设计模式，最终的目的还是**提高代码的可读性、可扩展性、复用性、可维护性等**。我们在考虑应用某一个设计原则是否合理的时候，也可以以此作为最终的考量标准。
</p> <p><strong>单一职责：将相关的“在一起”，提高内聚，避免不相关的“在一起”，降低耦合，讲的是可维护性问题</strong>。</p> <h2 id="开闭原则-open-closed-principle"><a href="#开闭原则-open-closed-principle" class="header-anchor">#</a> 开闭原则 Open Closed Principle</h2> <p>开闭原则是 SOLID 中最难理解、最难掌握，同时也是最有用的一条原则。</p> <ul><li>难理解：怎么定义代码的“扩展”、“修改”，怎样算满足或违反“开闭原则”</li> <li>难掌握：如果做到“对扩展开放、修改关闭”，如何在项目中灵活应用“开闭原则”，以避免影响代码可读性</li> <li>最有用：<strong>扩展性</strong>是代码质量最重要的衡量标准之一。大部分设计模式就是为了解决代码的扩展性而存在的，主要遵从的设计原则就是开闭原则</li></ul> <h3 id="如何理解-对扩展开发、修改关闭"><a href="#如何理解-对扩展开发、修改关闭" class="header-anchor">#</a> 如何理解“对扩展开发、修改关闭”</h3> <p>开闭原则的英文全称是 Open Closed Principle，简写为 OCP。它的英文描述是：software entities (modules, classes, functions, etc.) should be open for extension , but closed for modification。我们把它翻译成中文就是：<strong>软件实体（模块、类、方法等）应该“对扩展开放、对修改关闭”</strong>。</p> <p>更详细的表述就是：<strong>添加一个新的功能应该是，在已有代码基础上扩展代码（新增模块、类、方法等），而非修改已有代码（修改模块、类、方法等）</strong>。</p> <p>看一个例子，API 接口监控告警代码</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">/**
 * 其中：
 * AlertRule 存储告警规则，可以自由设置。
 * Notification 是告警通知类，支持邮件、短信、微信、手机等多种通知渠道。
 * NotificationEmergencyLevel 表示通知的紧急程度，包括 SEVERE（严重）、URGENCY（紧急）、NORMAL（普通)
 * 
 */</span>
<span class="token keyword">class</span> <span class="token class-name">Alert</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> rule<span class="token operator">:</span> AlertRule<span class="token punctuation">;</span>
  <span class="token keyword">private</span> notification<span class="token operator">:</span> Notification<span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span>rule<span class="token operator">:</span> AlertRule<span class="token punctuation">,</span> notification<span class="token operator">:</span> Notification<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>rule <span class="token operator">=</span> rule<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>notification <span class="token operator">=</span> notification<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">check</span><span class="token punctuation">(</span>api<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> requestCount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> errorCount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>  durationOfSeconds<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> tps <span class="token operator">=</span> requestCount <span class="token operator">/</span> durationOfSeconds<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>tps <span class="token operator">&gt;</span> rule<span class="token punctuation">.</span><span class="token function">getMatchedRule</span><span class="token punctuation">(</span>api<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMaxTps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      notification<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span>NotificationEmergencyLevel<span class="token punctuation">.</span><span class="token constant">URGENCY</span><span class="token punctuation">,</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>errorCount <span class="token operator">&gt;</span> rule<span class="token punctuation">.</span><span class="token function">getMatchedRule</span><span class="token punctuation">(</span>api<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMaxErrorCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      notification<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span>NotificationEmergencyLevel<span class="token punctuation">.</span><span class="token constant">SEVERE</span><span class="token punctuation">,</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>代码比较简单，逻辑集中在 check 方法中。现在我们需要<strong>增加一个功能</strong>，当每秒接口请求超时个数大于设定值时，触发告警。</p> <h4 id="在现有代码上改动"><a href="#在现有代码上改动" class="header-anchor">#</a> 在现有代码上改动</h4> <ul><li>增加 check 入参：增加新的统计数据 timeoutCount，表示超时请求数</li> <li>增加告警规则：在 check 中添加新的告警逻辑</li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">class</span> <span class="token class-name">Alert</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">check</span><span class="token punctuation">(</span>api<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> requestCount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> errorCount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> timeoutCount<span class="token operator">:</span> <span class="token builtin">number</span>  durationOfSeconds<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">const</span> timeoutTps <span class="token operator">=</span> timeoutCount <span class="token operator">/</span> durationOfSeconds<span class="token punctuation">;</span> 
    <span class="token keyword">if</span> <span class="token punctuation">(</span>timeoutTps <span class="token operator">&gt;</span> rule<span class="token punctuation">.</span><span class="token function">getMatchedRule</span><span class="token punctuation">(</span>api<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMaxTimeoutTps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
      notification<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span>NotificationEmergencyLevel<span class="token punctuation">.</span><span class="token constant">URGENCY</span><span class="token punctuation">,</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="存在的问题"><a href="#存在的问题" class="header-anchor">#</a> 存在的问题</h4> <ul><li>对接口进行了修改，意味着所有调用这个接口的代码都要做相应的修改</li> <li>另一方面，修改了 check，相应单元测试都需要修改</li></ul> <p>属于基于“修改”的方式实现功能<strong>修改了代码的实现</strong>。</p> <h4 id="更好的方式-遵循开闭原则"><a href="#更好的方式-遵循开闭原则" class="header-anchor">#</a> 更好的方式，遵循开闭原则</h4> <p>通过“扩展方式”来实现。为了让它的扩展性更好，重构之前的代码。</p> <ul><li>将多个入参封装成 ApiStatInfo 类</li> <li>引入 handler，将 if 判断逻辑分散在各个 handler 中</li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>
<span class="token keyword">class</span> <span class="token class-name">Alert</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> alertHandlers<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>AlertHandler<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  
  <span class="token function">addAlertHandler</span><span class="token punctuation">(</span>alertHandler<span class="token operator">:</span> AlertHandler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>alertHandlers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>alertHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">check</span><span class="token punctuation">(</span>apiStatInfo<span class="token operator">:</span> ApiStatInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    alertHandlers<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>handler <span class="token operator">=&gt;</span> handler<span class="token punctuation">.</span><span class="token function">check</span><span class="token punctuation">(</span>apiStatInfo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">ApiStatInfo</span> <span class="token punctuation">{</span><span class="token comment">//省略constructor/getter/setter方法</span>
  <span class="token keyword">private</span> api<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> requestCount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> errorCount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> durationOfSeconds<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 定义抽象类</span>
<span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AlertHandler</span> <span class="token punctuation">{</span>
  <span class="token keyword">protected</span> rule<span class="token operator">:</span> AlertRule<span class="token punctuation">;</span>
  <span class="token keyword">protected</span> notification<span class="token operator">:</span> Notification<span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span>rule<span class="token operator">:</span> AlertRule<span class="token punctuation">,</span> notification<span class="token operator">:</span> Notification<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>rule <span class="token operator">=</span> rule<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>notification <span class="token operator">=</span> notification<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">abstract</span> <span class="token function">check</span><span class="token punctuation">(</span>apiStatInfo<span class="token operator">:</span> ApiStatInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 继承，代码复用</span>
<span class="token keyword">class</span> <span class="token class-name">TpsAlertHandler</span> <span class="token keyword">extends</span> <span class="token class-name">AlertHandler</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>rule<span class="token operator">:</span> AlertRule<span class="token punctuation">,</span> notification<span class="token operator">:</span> Notification<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>rule<span class="token punctuation">,</span> notification<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">check</span><span class="token punctuation">(</span>apiStatInfo<span class="token operator">:</span> ApiStatInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> tps <span class="token operator">=</span> apiStatInfo<span class="token punctuation">.</span><span class="token function">getRequestCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span> apiStatInfo<span class="token punctuation">.</span><span class="token function">getDurationOfSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>tps <span class="token operator">&gt;</span> rule<span class="token punctuation">.</span><span class="token function">getMatchedRule</span><span class="token punctuation">(</span>apiStatInfo<span class="token punctuation">.</span><span class="token function">getApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMaxTps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      notification<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span>NotificationEmergencyLevel<span class="token punctuation">.</span><span class="token constant">URGENCY</span><span class="token punctuation">,</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">ErrorAlertHandler</span> <span class="token keyword">extends</span> <span class="token class-name">AlertHandler</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><p>接下来看看怎么新增上面的功能？</p> <p>首先创建一个类，负责 Alert 的创建、组装（alertRule 和 notification 依赖注入）、初始化（添加 handler）工作。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">class</span> <span class="token class-name">ApplicationContext</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> alertRule<span class="token operator">:</span> AlertRule<span class="token punctuation">;</span> 
  <span class="token keyword">private</span> notification<span class="token operator">:</span> Notification<span class="token punctuation">;</span> 
  <span class="token keyword">private</span> alert<span class="token operator">:</span> Alert<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> instance<span class="token operator">:</span> ApplicationContext<span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initializeBeans</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">initializeBeans</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>alertRule <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlertRule</span><span class="token punctuation">(</span><span class="token comment">/*.省略参数.*/</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//省略一些初始化代码</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>notification <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Notification</span><span class="token punctuation">(</span><span class="token comment">/*.省略参数.*/</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//省略一些初始化代码</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>alert <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Alert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>alert<span class="token punctuation">.</span><span class="token function">addAlertHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TpsAlertHandler</span><span class="token punctuation">(</span>alertRule<span class="token punctuation">,</span> notification<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>alert<span class="token punctuation">.</span><span class="token function">addAlertHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ErrorAlertHandler</span><span class="token punctuation">(</span>alertRule<span class="token punctuation">,</span> notification<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">getAlert</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>alert<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 单实例</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Demo</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> apiStatInfo<span class="token operator">:</span> ApiStatInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApiStatInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...省略设置apiStatInfo数据值的代码</span>
    ApplicationContext<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAlert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">check</span><span class="token punctuation">(</span>apiStatInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p>这个是再修改那个代码：</p> <ul><li>第一处改动是：在 ApiStatInfo 类中添加新的属性 timeoutCount。</li> <li>第二处改动是：添加新的 TimeoutAlertHander 类。</li> <li>第三处改动是：在 ApplicationContext 类的 initializeBeans() 方法中，往 alert 对象中注册新的 timeoutAlertHandler。</li> <li>第四处改动是：在使用 Alert 类的时候，需要给 check() 函数的入参 apiStatInfo 对象设置 timeoutCount 的值。</li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">class</span> <span class="token class-name">ApiStatInfo</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  <span class="token comment">// 改动一：添加新字段</span>
  <span class="token keyword">private</span> timeoutCount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>

<span class="token comment">// 改动二：添加新的handler</span>
<span class="token keyword">class</span> <span class="token class-name">TimeoutAlertHandler</span> <span class="token keyword">extends</span> <span class="token class-name">AlertHandler</span> <span class="token punctuation">{</span> 
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span> 

<span class="token keyword">class</span> <span class="token class-name">ApplicationContext</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initializeBeans</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">initializeBeans</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token comment">// 改动三：注册handler</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>alert<span class="token punctuation">.</span><span class="token function">addAlertHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TimeoutAlertHandler</span><span class="token punctuation">(</span>alertRule<span class="token punctuation">,</span> notification<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Demo</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> apiStatInfo<span class="token operator">:</span> ApiStatInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApiStatInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 改动四：设置tiemoutCount值</span>
    apiStatInfo<span class="token punctuation">.</span><span class="token function">setTimeoutCount</span><span class="token punctuation">(</span><span class="token number">289</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ApplicationContext<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAlert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">check</span><span class="token punctuation">(</span>apiStatInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p><img src="/reading-notes/assets/img/design-principles-OCP.5c3d5e66.png" alt="重构之后"></p> <p>重构之后代码更加易扩展，如果想加新的功能：</p> <ul><li>只需要基于扩展方式创建新的 handler 类即可，不需要改原来的 check() 函数逻辑。</li> <li>而且只需求为新添加的 handler 类增加单元测试，老的单元测试不会失败。</li></ul> <h3 id="修改代码就意味着违背开闭原则吗"><a href="#修改代码就意味着违背开闭原则吗" class="header-anchor">#</a> 修改代码就意味着违背开闭原则吗</h3> <p>对于重构之后的代码，除了改动二是基于扩展而非修改的方式完成的，但是其他貌似不是基于扩展而是基于修改来完成的，那是不是违背了开闭原则吗？</p> <h4 id="改动一-添加新的属性-timeoutcount"><a href="#改动一-添加新的属性-timeoutcount" class="header-anchor">#</a> 改动一 添加新的属性 timeoutCount</h4> <p>实际上不仅往类添加属性，还添加了对应的 getter/setter 方法，所以这个问题是：<strong>给类中添加新的属性和方法，算作“修改”还是“扩展”？</strong></p> <p>回忆一下开闭原则的定义：软件实体（<strong>模块、类、方法等</strong>）应该“对扩展开放、对修改关闭”。从定义中可以看出，开闭原则可以用在不同粒度的代码中，可以是模块、类、方法（及属性）</p> <p><strong>同样一个代码改动，在粗代码粒度下，被认定为“修改”，在细代码粒度下，又可以被认定为“扩展”</strong>。</p> <p>改动一，在类层面，添加属性和方法，可以被认定为“修改”；但在方法（及属性）层面上，没有修改已有属性和方法，又可以认定为“扩展”。</p> <p>回到这条原则的初衷，我们不用纠结它是否违背“开闭原则”。<strong>只要它没有破坏原有的代码的正常运行，没有破坏原有的单元测试，我们就可以说，这是一个合格的代码改动</strong>。</p> <h4 id="改动三和四-增加注册和入参的设置"><a href="#改动三和四-增加注册和入参的设置" class="header-anchor">#</a> 改动三和四 增加注册和入参的设置</h4> <p>这两处修改是在方法内部进行的，不管从哪个层面上来看都不能算是“扩展”。不过<strong>有些修改是难免的</strong>，是可以接受的。</p> <p>我们要认识到，添加一个功能，不可能任何模块、类、方法的代码都不“修改”，这个是做不到的。类需要创建、组装、并做一些初始化操作，才能构建成可运行的程序。我们要做的是<strong>尽量让修改操作更集中、更少、更上层，尽量让最核心、最复杂的那部分代码满足开闭原则</strong>。</p> <h3 id="如何做到-对扩展开放、修改关闭"><a href="#如何做到-对扩展开放、修改关闭" class="header-anchor">#</a> 如何做到“对扩展开放、修改关闭”</h3> <p>在前面的例子中，实现需要一些经验。不过要做到“对扩展开放、修改关闭”，也有一些指导思想和方法论。</p> <p><strong>实际上，开闭原则讲的就是代码的扩展性问题，是判断一段代码是否易扩展的“金标准”</strong>。</p> <h4 id="具备潜意识"><a href="#具备潜意识" class="header-anchor">#</a> 具备潜意识</h4> <p>介绍方法论之前，我们先一些更偏向顶层的指导思想。<strong>为了写出扩展性好的代码，要时刻具备扩展意识、抽象意识、封装意识，这些“潜意识”比任何开发技巧都重要</strong>。</p> <ul><li>写代码的时候，多花心思思考一下，预留扩展点，未来需求变化的时候不需要做代码改动、改动很小，做到“对扩展开发、对修改关闭”</li> <li>识别代码可变部分和不可变部分之后，将可变部分封装起来，隔离变化，提供抽象化的不可变接口给上层使用（基于接口而非实现编程）。这样当实现发现变化的时候，只需要基于相同的抽象接口，扩展一个新的实现，替换掉老实现就可以了。</li></ul> <h4 id="方法论"><a href="#方法论" class="header-anchor">#</a> 方法论</h4> <p><strong>在众多的设计原则、思想、模式中，最常用来提高代码扩展性的方法有：多态、依赖注入、基于接口而非实现编程，以及大部分的设计模式（比如，装饰、策略、模板、职责链、状态等）</strong>。</p> <p>多态、依赖注入、基于接口而非实现编程，以及前面提到的抽象意识，说的都是同一种思路，只是从不同角度、不同层面阐述而已。这也体现了“很多设计原则、思想、模式都是想通的”这一思想。</p> <p>下面看一个例子：</p> <ul><li>要学会将其<strong>抽象</strong>成一组跟具体消息队列（Kafka）无关的异步消息接口</li> <li>上层系统都依赖这组抽象的<strong>接口编程</strong>，并且通过<strong>依赖注入</strong>的方式来调用</li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// 这一部分体现了抽象意识</span>
<span class="token keyword">interface</span> <span class="token class-name">MessageQueue</span> <span class="token punctuation">{</span> <span class="token comment">/** */</span> <span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">KafkaMessageQueue</span> <span class="token keyword">implements</span> <span class="token class-name">MessageQueue</span> <span class="token punctuation">{</span> <span class="token comment">/** */</span> <span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">RocketMQMessageQueue</span> <span class="token keyword">implements</span> <span class="token class-name">MessageQueue</span> <span class="token punctuation">{</span><span class="token comment">/** */</span><span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">MessageFromatter</span> <span class="token punctuation">{</span> <span class="token comment">/** */</span> <span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">JsonMessageFromatter</span> <span class="token keyword">implements</span> <span class="token class-name">MessageFromatter</span> <span class="token punctuation">{</span><span class="token comment">/** */</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">ProtoBufMessageFromatter</span> <span class="token keyword">implements</span> <span class="token class-name">MessageFromatter</span> <span class="token punctuation">{</span><span class="token comment">/** */</span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Demo</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> msgQueue<span class="token operator">:</span> MessageQueue<span class="token punctuation">;</span> <span class="token comment">// 基于接口而非实现编程</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>msgQueue<span class="token operator">:</span> MessageQueue<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 依赖注入</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>msgQueue <span class="token operator">=</span> msgQueue<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// msgFormatter：多态、依赖注入</span>
  <span class="token function">sendNotification</span><span class="token punctuation">(</span>notification<span class="token operator">:</span> Notification<span class="token punctuation">,</span> msgFormatter<span class="token operator">:</span> MessageFormatter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//...    </span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="如何在项目中灵活应用开闭原则"><a href="#如何在项目中灵活应用开闭原则" class="header-anchor">#</a> 如何在项目中灵活应用开闭原则</h3> <p>写出支持“对扩展开放、对修改关闭”的代码的<strong>关键是预留扩展点</strong>。那问题是如何才能识别出所有可能的扩展点呢？</p> <ul><li>业务导向系统：要识别扩展点，就要对业务有足够的了解，能够知道当下以及未来可能要支持的业务需求。</li> <li>业务无关、偏底层系统：你需要了解“它们会被如何使用？今后你打算添加哪些功能？使用者未来会有哪些更多的功能需求？”</li></ul> <p>不过，“唯一不变的只有变化本身”。即便我们很了解也不能识别出所有扩展点。即便都识别出来，对所有扩展点都预留位置，成本也是不可接受的。</p> <p><strong>没必要为一些遥远的、不一定发生的需求去提前买单，做过度设计</strong>。</p> <p><strong>对于一些比较确定的、短期内可能就会扩展，或者需求改动对代码结构影响比较大的情况，或者实现成本不高的扩展点，在编写代码的时候之后，我们就可以事先做些扩展性设计。而不确定的、实现复杂的，可以等到有需求驱动的时候在通过重构来支持。</strong></p> <p>而且，开闭原则也不是免费的，有些时候和可读性会有冲突，需要做些权衡。之前的例子中，如果告警规则不多，也不复杂，那么最开始的方式 check 中用 if 判断，整体逻辑不复杂，代码行数也不对，思路更加简单易读，就是比较合理的选择。反之，第二种方式更合适。</p> <h2 id="里式替换-liskov-substitution-principle"><a href="#里式替换-liskov-substitution-principle" class="header-anchor">#</a> 里式替换 Liskov Substitution Principle</h2> <p>整体上这个原则比较简单，主要通过几个反例，看看，哪些代码是违反里式替换原则的？我们该如何将它们改造成满足里式替换原则？</p> <p>另外这条原则的定义和“多态”有点类似，也介绍它跟多态的区别。</p> <h3 id="如何理解-里式替换原则"><a href="#如何理解-里式替换原则" class="header-anchor">#</a> 如何理解“里式替换原则”</h3> <p>里式替换原则的英文翻译是：Liskov Substitution Principle，缩写为 LSP。这个原则最早是在 1986 年由 Barbara Liskov 提出，他是这么描述这条原则的：</p> <blockquote><p>If S is a subtype of T, then objects of type T may be replaced with objects of type S, without breaking the program。</p></blockquote> <p>在 1996 年，Robert Martin 在他的 SOLID 原则中，重新描述了这个原则，英文原话是这样的：</p> <blockquote><p>Functions that use pointers of references to base classes must be able to use objects of derived classes without knowing it。</p></blockquote> <p>综合起来，用中文描述是：<strong>子类对象</strong>（object of subtype/derived class）能够替换程序（program）中<strong>父类对象</strong>（object of base/parent class）出现的任何地方，并且<strong>保证原来程序的逻辑行为（behavior）不变及正确性不被破坏</strong>。</p> <p>看个例子：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>
<span class="token keyword">class</span> <span class="token class-name">Transporter</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> httpClient<span class="token operator">:</span> HttpClient<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token function">Transporter</span><span class="token punctuation">(</span>httpClient<span class="token operator">:</span> HttpClient<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>httpClient <span class="token operator">=</span> httpClient<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> Response <span class="token function">sendRequest</span><span class="token punctuation">(</span>Request request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...use httpClient to send request</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityTransporter</span> <span class="token keyword">extends</span> <span class="token class-name">Transporter</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> String appId<span class="token punctuation">;</span>
  <span class="token keyword">private</span> String appToken<span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span>httpClient<span class="token operator">:</span> HttpClient<span class="token punctuation">,</span> appId<span class="token operator">:</span> String<span class="token punctuation">,</span>  appToken<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>httpClient<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>appId <span class="token operator">=</span> appId<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>appToken <span class="token operator">=</span> appToken<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">sendRequest</span><span class="token punctuation">(</span>request<span class="token operator">:</span> Request<span class="token punctuation">)</span><span class="token operator">:</span> Response <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>appId<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> StringUtils<span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>appToken<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      request<span class="token punctuation">.</span><span class="token function">addPayload</span><span class="token punctuation">(</span><span class="token string">&quot;app-id&quot;</span><span class="token punctuation">,</span> appId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      request<span class="token punctuation">.</span><span class="token function">addPayload</span><span class="token punctuation">(</span><span class="token string">&quot;app-token&quot;</span><span class="token punctuation">,</span> appToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">sendRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Demo</span> <span class="token punctuation">{</span>    
  <span class="token keyword">public</span> <span class="token function">demoFunction</span><span class="token punctuation">(</span>transporter<span class="token operator">:</span> Transporter<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
    <span class="token keyword">const</span> request<span class="token operator">:</span> Reuqest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//...省略设置request中数据值的代码...</span>
    <span class="token keyword">const</span> response<span class="token operator">:</span> Response <span class="token operator">=</span> transporter<span class="token punctuation">.</span><span class="token function">sendRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//...省略其他逻辑...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 里式替换原则</span>
<span class="token keyword">const</span> demo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
demo<span class="token punctuation">.</span><span class="token function">demofunction</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SecurityTransporter</span><span class="token punctuation">(</span><span class="token comment">/*省略参数*/</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>子类 SecurityTransporter 的设计完全符合里式替换原则，可以替换父类出现的任何位置，并且原来代码的逻辑行为不变且正确性也没有被破坏。</p> <ul><li>这个代码设计不就是简单利用了面向对象的多态特性吗？</li></ul> <p>从刚刚的例子和定义描述来看，<strong>里式替换原则跟多态看起来确实有点类似，但实际上它们完全是两回事</strong>。</p> <ul><li>为什么这么说呢？</li></ul> <p>把上面例子改一下</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token punctuation">{</span>
  <span class="token function">sendRequest</span><span class="token punctuation">(</span>request<span class="token operator">:</span> Request<span class="token punctuation">)</span><span class="token operator">:</span> Response <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>appId<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> StringUtils<span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>appToken<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 抛出异常</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'xxx'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    request<span class="token punctuation">.</span><span class="token function">addPayload</span><span class="token punctuation">(</span><span class="token string">&quot;app-id&quot;</span><span class="token punctuation">,</span> appId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    request<span class="token punctuation">.</span><span class="token function">addPayload</span><span class="token punctuation">(</span><span class="token string">&quot;app-token&quot;</span><span class="token punctuation">,</span> appToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">sendRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>改造后，传入 demofunction 的是父类，那么不会抛出异常，但如果是子类，那么有可能抛出异常。子类替换父类传递进 demoFunction 函数之后，整个程序的逻辑行为<strong>有了改变</strong>。</p> <p>改造之后仍然可以通过 Java 的多态语法，动态使用子类 SecurityTransporter 来替换父类 Transporter，并不会导致程序编译/运行报错。但是，从设计思路里式替换原则。</p> <h4 id="里式替换和多态的区别"><a href="#里式替换和多态的区别" class="header-anchor">#</a> 里式替换和多态的区别</h4> <p><strong>所以说多态和里式替换有点类似，但是关注点不同</strong>：</p> <ul><li>多态：是面向对象的特性，也是面向对象编程语言的一种语法，是一种代码实现的思路。</li> <li>里式替换：是一种设计原则，用来指导继承关系中的子类如何设计。子类要保证替换父类的时候，不改变原有的逻辑，不破坏原有程序的正确性。</li></ul> <h3 id="哪些代码明显违背了-lsp"><a href="#哪些代码明显违背了-lsp" class="header-anchor">#</a> 哪些代码明显违背了 LSP</h3> <p>里式替换原则还有另外一个更加能落地、更有指导意义的描述，那就是“Design By Contract”，中文翻译就是“<strong>按照协议来设计</strong>”。</p> <p>具体来说，子类在设计的时候，要遵守父类的行为约定（或者叫协议）。父类定义了函数的行为约定，那子类可以改变函数的内部实现逻辑，但不能改变函数原有的行为约定。</p> <p>这里的行为约定包括：</p> <ul><li>函数声明要实现的功能；</li> <li>对输入、输出、异常的约定；</li> <li>甚至包括注释中所罗列的任何特殊说明。</li></ul> <p>实际上，定义中父类和子类之间的关系，也可以替换成接口和实现类之间的关系。</p> <h4 id="子类违背父类声明要实现的功能"><a href="#子类违背父类声明要实现的功能" class="header-anchor">#</a> 子类违背父类声明要实现的功能</h4> <p>父类中提供的 sortOrdersByAmount() 订单排序函数，是<strong>按照金额从小到大</strong>来给订单排序的，而子类重写这个 sortOrdersByAmount() 订单排序函数之后，是<strong>按照创建日期</strong>来给订单排序的。那子类的设计就违背里式替换原则。</p> <h4 id="子类违背父类对输入、输出、异常的约定"><a href="#子类违背父类对输入、输出、异常的约定" class="header-anchor">#</a> 子类违背父类对输入、输出、异常的约定</h4> <p>在父类中，某个函数约定：运行出错的时候返回 null；获取数据为空的时候返回空集合（empty collection）。而子类重载函数之后，实现变了，运行出错返回异常（exception），获取不到数据返回 null。那子类的设计就违背里式替换原则。</p> <h4 id="子类违背父类注释中所罗列的任何特殊说明"><a href="#子类违背父类注释中所罗列的任何特殊说明" class="header-anchor">#</a> 子类违背父类注释中所罗列的任何特殊说明</h4> <p>父类中定义的 withdraw() 提现函数的注释是这么写的：“用户的提现金额不得超过账户余额……”，而子类重写 withdraw() 函数之后，针对 VIP 账号实现了透支提现的功能，也就是提现金额可以大于账户余额，那这个子类的设计也是不符合里式替换原则的。</p> <p>以上便是三种典型的违背里式替换原则的情况。除此之外，<strong>判断子类的设计实现是否违背里式替换原则，还有一个小窍门，那就是拿父类的单元测试去验证子类的代码</strong>。如果某些单元测试运行失败，就有可能说明，子类的设计实现没有完全地遵守父类的约定，子类有可能违背了里式替换原则。</p> <p>里式替换这个原则是非常宽松的，一般写代码不怎么回违背它。</p> <h2 id="接口隔离原则-interface-segregation-principle"><a href="#接口隔离原则-interface-segregation-principle" class="header-anchor">#</a> 接口隔离原则 Interface Segregation Principle</h2> <p>这个原则，最关键就是理解其中“接口”的含义。除此之外，接口隔离原则跟我们之前讲到的<strong>单一职责原则</strong>还有点儿类似，所以也会具体讲一下它们之间的区别和联系。</p> <h3 id="如何理解-接口隔离原则"><a href="#如何理解-接口隔离原则" class="header-anchor">#</a> 如何理解“接口隔离原则”</h3> <p>接口隔离原则的英文翻译是“ Interface Segregation Principle”，缩写为 ISP。Robert Martin 在 SOLID 原则中是这样定义它的：“Clients should not be forced to depend upon interfaces that they do not use。”</p> <p>直译成中文的话就是：<strong>客户端不应该被强迫依赖它不需要的接口</strong>。其中的“客户端”，可以理解为接口的调用者或者使用者。</p> <p>“接口”在不同场景有不同理解，在生活中可以是插座接口，在软件开发中，可以是一组抽象的约定、系统之间的 API 接口、还可以特指面向对象编程语言的接口。理解接口隔离原则的关键，就是理解其中的“接口”二字。在这条原则中，我们可以把“接口”理解为下面三种东西：</p> <ul><li>一组 API 接口集合</li> <li>单个 API 接口或函数</li> <li>OOP 中的接口概念</li></ul> <h3 id="把-接口-理解为一组-api-接口集合"><a href="#把-接口-理解为一组-api-接口集合" class="header-anchor">#</a> 把“接口”理解为一组 API 接口集合</h3> <p>看个例子，微服务用户系统提供了一组跟用户相关的 API 给其他系统使用，比如：注册、登录、获取用户信息等</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>
<span class="token keyword">interface</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
  <span class="token function">register</span><span class="token punctuation">(</span>String cellphone<span class="token punctuation">,</span> String password<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  <span class="token function">login</span><span class="token punctuation">(</span>String cellphone<span class="token punctuation">,</span> String password<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  <span class="token function">getUserInfoById</span><span class="token punctuation">(</span>long id<span class="token punctuation">)</span><span class="token operator">:</span> UserInfo<span class="token punctuation">;</span>
  <span class="token function">getUserInfoByCellphone</span><span class="token punctuation">(</span>String cellphone<span class="token punctuation">)</span><span class="token operator">:</span> UserInfo<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>现在，我们的后台管理系统要实现删除用户的功能，希望用户系统提供一个删除用户的接口。这个时候我们该如何来做呢？</p> <p>你可能会说，这不是很简单吗，我只需要在 UserService 中新添加一个 deleteUserByCellphone() 或 deleteUserById() 接口就可以了</p> <p>可以解决问题，但是也隐藏了一些安全隐患：删除用户是一个非常慎重的操作，我们只希望通过后台管理系统来执行，所以这个接口只限于给后台管理系统使用。如果我们把它放到 UserService 中，<strong>那所有使用到 UserService 的系统，都可以调用这个接口</strong>。不加限制地被其他业务系统调用，就有可能导致误删用户。</p> <p>当然，最好的解决方案是从架构设计的层面，通过接口鉴权的方式来限制接口的调用。不过，如果暂时没有鉴权框架来支持，我们<strong>还可以从代码设计的层面，尽量避免接口被误用</strong>。</p> <p><strong>参照接口隔离原则，调用者不应该强迫依赖它不需要的接口，将删除接口单独放到另外一个接口</strong> RestrictedUserService 中，然后将 RestrictedUserService 只打包提供给后台管理系统来使用。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
  <span class="token function">register</span><span class="token punctuation">(</span>String cellphone<span class="token punctuation">,</span> String password<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  <span class="token function">login</span><span class="token punctuation">(</span>String cellphone<span class="token punctuation">,</span> String password<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  <span class="token function">getUserInfoById</span><span class="token punctuation">(</span>long id<span class="token punctuation">)</span><span class="token operator">:</span> UserInfo<span class="token punctuation">;</span>
  <span class="token function">getUserInfoByCellphone</span><span class="token punctuation">(</span>String cellphone<span class="token punctuation">)</span><span class="token operator">:</span> UserInfo<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 拆分</span>
<span class="token keyword">interface</span> <span class="token class-name">RestrictedUserService</span> <span class="token punctuation">{</span>
  <span class="token function">deleteUserByCellphone</span><span class="token punctuation">(</span>String cellphone<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  <span class="token function">deleteUserById</span><span class="token punctuation">(</span>long id<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 只给管理系统使用</span>
<span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span><span class="token punctuation">,</span> RestrictedUserService <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>这个例子中，把接口隔离原则中的接口，理解为一组接口集合，它可以是某个微服务的接口，也可以是某个类库的接口等等。</p> <p>在设计微服务或者类库接口的时候，<strong>如果部分接口只被部分调用者使用，那我们就需要将这部分接口隔离出来，单独给对应的调用者使用，而不是强迫其他调用者也依赖这部分不会被用到的接口</strong>。</p> <h3 id="把-接口-理解为单个-api-接口或函数"><a href="#把-接口-理解为单个-api-接口或函数" class="header-anchor">#</a> 把“接口”理解为单个 API 接口或函数</h3> <p>现在我们再换一种理解方式，<strong>把接口理解为单个接口或函数（以下为了方便讲解，我都简称为“函数”）。那接口隔离原则就可以理解为：函数的设计要功能单一，不要将多个不同的功能逻辑在一个函数中实现</strong>。（这个定义和单一职责很像！）</p> <p>看个例子</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Statistics</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> max<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> min<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> average<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> sum<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> percentile99<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> percentile999<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token comment">//...省略constructor/getter/setter等方法...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">count</span><span class="token punctuation">(</span>dataSet<span class="token punctuation">)</span><span class="token operator">:</span> Statistics <span class="token punctuation">{</span>
  Statistics statistics <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Statistics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//...省略计算逻辑...</span>
  <span class="token keyword">return</span> statistics<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>上面代码，count() 函数的功能不够单一，<strong>包含很多不同的统计功能</strong>，比如，求最大值、最小值、平均值等等。按照接口隔离原则，我们应该把 count() 函数拆成几个更小粒度的函数，每个函数负责一个独立的统计功能。</p> <p>不过从另一个角度，这些功能都是和统计相关，所以 count 的职责也算单一。</p> <p>判定功能是否单一，<strong>除了很强的主观性，还需要结合具体的场景</strong>。如果实际每个统计需求，Statistics 定义的属性都涉及，那么 count 设计是合理。如果每个统计值涉及一部分，而 count 每次都会吧所有统计信息都计算一遍，势必会影响性能，这个时候就不合理应该拆开。</p> <h4 id="接口隔离原则和单一职责的区别"><a href="#接口隔离原则和单一职责的区别" class="header-anchor">#</a> 接口隔离原则和单一职责的区别</h4> <ul><li>单一职责原则针对的是模块、类、接口的设计</li> <li>而接口隔离原则相对于单一职责原则，一方面它更<strong>侧重于接口的设计</strong>，另一方面它的思考的角度不同。它<strong>提供了一种判断接口是否职责单一的标准</strong>：通过调用者如何使用接口来间接地判定。如果调用者只使用部分接口或接口的部分功能，那接口的设计就不够职责单一。</li></ul> <h3 id="把-接口-理解为-oop-中的接口概念"><a href="#把-接口-理解为-oop-中的接口概念" class="header-anchor">#</a> 把“接口”理解为 OOP 中的接口概念</h3> <p>还可以把“接口”理解为 OOP 中的接口概念，比如 TS 中的 interface。那接口的设计要尽量单一，不要让接口的实现类和调用者，依赖不需要的接口函数。</p> <h2 id="依赖反转原则-dependency-inversion-principle"><a href="#依赖反转原则-dependency-inversion-principle" class="header-anchor">#</a> 依赖反转原则 Dependency Inversion Principle</h2> <p>和单一原则相反，这个原则用起来比较简单，但概念理解起来比较难。比如，下面这几个问题，你看看能否清晰地回答出来：</p> <ul><li>“依赖反转”这个概念指的是“谁跟谁”的“什么依赖”被反转了？“反转”两个字该如何理解？</li> <li>还经常听到另外两个概念：“<strong>控制反转</strong>”和“<strong>依赖注入</strong>”。这两个概念跟“<strong>依赖反转</strong>”有什么区别和联系呢？它们说的是同一个事情吗？</li> <li>Spring 框架中的 IOC 跟这些概念又有什么关系呢</li></ul> <h3 id="控制反转-ioc"><a href="#控制反转-ioc" class="header-anchor">#</a> 控制反转（IOC）</h3> <p>控制反转的英文翻译是 Inversion Of Control，缩写为 IOC。简单来说：将自己对程序执行流程的控制逻辑交给框架。</p> <p>控制反转是一个比较笼统的<strong>设计思想</strong>，并不是一种具体的实现方法，一般用来指导框架层面的设计。</p> <ul><li>“控制”指的是对程序执行流程的控制，</li> <li>而“反转”指的是在没有使用框架之前，程序员自己控制整个程序的执行。在使用框架之后，整个程序的执行流程通过框架来控制。<strong>流程的控制权从程序员“反转”给了框架</strong>。</li></ul> <p><img src="/reading-notes/assets/img/design-principles-IOC.055f1a70.png" alt="IOC"></p> <h3 id="依赖注入-di"><a href="#依赖注入-di" class="header-anchor">#</a> 依赖注入（DI）</h3> <p>依赖注入跟控制反转恰恰相反，它是一种具体的<strong>编码技巧</strong>。依赖注入的英文翻译是 Dependency Injection，缩写为 DI。</p> <p>对于这个概念，有一个非常形象的说法，那就是：依赖注入是一个标价 25 美元，实际上只值 5 美分的概念。也就是说，这个概念听起来很“高大上”，实际上，理解、应用起来非常简单。</p> <p>看个例子，Notification 类负责消息推送，依赖 MessageSender 类实现推送商品促销、验证码等消息给用户，分别用依赖注入和非依赖注入两种方式实现一下</p> <ul><li>使用非依赖注入</li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">class</span> <span class="token class-name">Notification</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> messageSender<span class="token operator">:</span> MessageSender<span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 此处有点像hardcode!</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>messageSender <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
  <span class="token function">sendMessage</span><span class="token punctuation">(</span>cellphone<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 省略校验逻辑等...</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>messageSender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>cellphone<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">MessageSender</span> <span class="token punctuation">{</span>
  <span class="token function">send</span><span class="token punctuation">(</span>cellphone<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//....</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 使用Notification</span>
<span class="token keyword">const</span> notification<span class="token operator">:</span> Notification <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Notification</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><ul><li>使用依赖注入</li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">class</span> <span class="token class-name">Notification</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> messageSender<span class="token operator">:</span> MessageSender<span class="token punctuation">;</span>

  <span class="token comment">// 通过构造函数将messageSender传递进来!</span>
  <span class="token function">constructor</span> <span class="token punctuation">(</span>messageSender<span class="token operator">:</span> MessageSender<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>messageSender <span class="token operator">=</span> messageSender<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">sendMessage</span><span class="token punctuation">(</span>cellphone<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//...省略校验逻辑等...</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>messageSender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>cellphone<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">MessageSender</span> <span class="token punctuation">{</span>
  <span class="token function">send</span><span class="token punctuation">(</span>cellphone<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//....</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 使用Notification</span>
<span class="token keyword">const</span> messageSender<span class="token operator">:</span> MessageSender <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> notification<span class="token operator">:</span> Notification <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Notification</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>通过依赖注入的方式来将依赖的类对象传递进来，这样就提高了代码的扩展性，我们可以灵活地替换依赖的类。</p> <p>当然上面代码还有持续优化空间，可以把 MessageSender 定义成接口，基于接口而非实现编程。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">MessageSender</span> <span class="token punctuation">{</span>
  <span class="token function">send</span><span class="token punctuation">(</span>cellphone<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">SmsSender</span> <span class="token keyword">implements</span> <span class="token class-name">MessageSender</span> <span class="token punctuation">{</span>
  <span class="token function">send</span><span class="token punctuation">(</span>cellphone<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>尽管依赖注入非常简单，掌握刚刚举的这个例子，就等于完全掌握了依赖注入，但却非常有用，<strong>它是编写可测试性代码最有效的手段</strong>。</p> <h3 id="依赖注入框架-di-framework"><a href="#依赖注入框架-di-framework" class="header-anchor">#</a> 依赖注入框架（DI Framework）</h3> <p>采用依赖注入方式之后，虽然我们不需要用类似 hard code 的方式在类内部通过 new 来创建 MessageSender 对象。但是，这个创建对象、组装（或注入）对象的工作仅仅是被移动到了更上层代码而已，还是需要我们程序员自己来实现</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">class</span> <span class="token class-name">Demo</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> sender<span class="token operator">:</span>MessageSender <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SmsSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建对象</span>
    <span class="token keyword">const</span> notification<span class="token operator">:</span> Notification <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Notification</span><span class="token punctuation">(</span>sender<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//依赖注入</span>
    notification<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token string">&quot;13918942177&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;短信验证码：2346&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>实际项目可能涉及几十、上百个类，类对象的创建和依赖注入会变得复杂。如果让程序员自己实现</p> <ul><li>容易出错且开发成本比较高</li> <li>而对象创建和依赖注入，本身和具体业务无关，完全可以抽象成框架来自动完成</li></ul> <p>这个框架就是“依赖注入框架”，只需要通过依赖注入框架提供的扩展点，简单配置一下所有需要创建的类对象、类与类之间的依赖关系，就可以实现由框架来自动创建对象、管理对象的生命周期、依赖注入等原本需要程序员来做的事情。</p> <p>现成的依赖注入框架有很多，比如 Google Guice、Java Spring。Spring 框架自己声称是<strong>控制反转容器</strong>（Inversion Of Control Container）</p> <p>两种说法都没错：</p> <ul><li>制反转容器这种表述是一种非常宽泛的描述</li> <li>DI 依赖注入框架的表述更具体、更有针对性</li></ul> <p>实现控制反转的方式有很多，除了依赖注入，还有模板模式等，而 Spring 框架的控制反转主要是通过依赖注入来实现的</p> <h3 id="依赖反转原则-dip"><a href="#依赖反转原则-dip" class="header-anchor">#</a> 依赖反转原则（DIP）</h3> <p><strong>依赖反转原则</strong>的英文翻译是 Dependency Inversion Principle，缩写为 DIP。中文翻译有时候也叫<strong>依赖倒置原则</strong>。</p> <blockquote><p>High-level modules shouldn’t depend on low-level modules. Both modules should depend on abstractions. In addition, abstractions shouldn’t depend on details. Details depend on abstractions.</p></blockquote> <p>大概意思就是：</p> <ul><li>高层模块（high-level modules）<strong>不要依赖</strong>低层模块（low-level）。高层模块和低层模块应该<strong>通过抽象</strong>（abstractions）来互相依赖。</li> <li>除此之外，抽象（abstractions）不要依赖具体实现细节（details），具体实现细节（details）依赖抽象（abstractions）。</li></ul> <p>其中高层模块和低层模块的划分，简单来说就是，<strong>在调用链上，调用者属于高层，被调用者属于底层</strong>。</p> <p>在平时的业务代码开发中，高层模块依赖底层模块是没有任何问题的。实际上，这条原则主要还是用来<strong>指导框架层面的设计</strong>。</p> <p>“基于接口而非实现编程”跟“依赖注入”，看起来非常类似，那它俩有什么区别和联系呢？</p> <ul><li>二者都是从外部传入依赖对象而不是在内部去new一个出来。</li> <li>“基于接口而非实现编程”强调的是“接口”，强调依赖的对象是接口，而不是具体的实现类；而“依赖注入”不强调这个，类或接口都可以，只要是从外部传入不是在内部 new 出来都可以称为依赖注入。</li></ul></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><div class="edit-link"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon edit-icon"><path d="M117.953 696.992 64.306 959.696l265.931-49.336 450.204-452.505-212.284-213.376-450.204 452.513zm496.384-296.326L219.039 797.993l-46.108-46.34L568.233 354.33l46.104 46.335zm345.357-122.99-114.45 115.04-212.288-213.377 114.45-115.035 212.288 213.371zm0 0" fill="currentColor"></path></svg> <a href="https://github.com/niexia/reading-notes/edit/main/docs/the-beauty-of-design-patterns/design-principles/SOLID.md" target="_blank" rel="noopener noreferrer">Edit this page</a></div> <div class="meta-item update-time"><span class="label">Last update:</span> <span class="info">May 2, 2022 17:33</span></div> <div class="meta-item contributors"><span class="label">Contributors: </span> <span class="info"><span title="email: yangjin.im@bytedance.com" class="contributor">
          杨金
        </span> <!----></span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/reading-notes/the-beauty-of-design-patterns/object-oriented/practice/" class="prev"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon prev-icon"><path d="M906.783 588.79c-.02 8.499-6.882 15.36-15.38 15.37l-443.7-.01 75.704 191.682c2.52 6.42.482 13.763-5.038 17.91-5.52 4.168-13.138 4.147-18.616-.092L123.228 524.175a15.362 15.362 0 0 1-6-12.165c0-4.782 2.222-9.277 6-12.185L499.753 210.35a15.388 15.388 0 0 1 9.38-3.195c3.236 0 6.502 1.034 9.236 3.103 5.52 4.147 7.578 11.49 5.038 17.91L447.683 419.84l443.72-.01c8.498.01 15.36 6.881 15.36 15.36l.02 153.6z" fill="currentColor"></path></svg>
        实战
      </a></span> <span class="next"><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/KISS/">
        KISS
        <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon next-icon"><path d="M906.772 512c0 4.772-2.211 9.267-5.99 12.175L524.257 813.66a15.37 15.37 0 0 1-18.616.092 15.368 15.368 0 0 1-5.038-17.91l75.714-191.672h-443.73c-8.488 0-15.36-6.881-15.36-15.36v-153.6c0-8.489 6.872-15.36 15.36-15.36h443.73l-75.714-191.682a15.358 15.358 0 0 1 5.048-17.91c5.51-4.158 13.128-4.137 18.606.092l376.525 289.485a15.323 15.323 0 0 1 5.99 12.165z" fill="currentColor"></path></svg></a></span></p></div> <!----> <!----> <div class="content__page-bottom"></div></main> <!----></div><div class="global-ui"><!----><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="Close" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. </p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>Description</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        Install <span></span></button> <button class="cancel-button">
        Cancel
      </button></div></div></div></div><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button class="pswp__button pswp__button--close"></button> <button class="pswp__button pswp__button--share"></button> <button class="pswp__button pswp__button--fs"></button> <button class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button class="pswp__button pswp__button--arrow--left"></button> <button class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div><!----><!----></div></div>
    <script src="/reading-notes/assets/js/app.e6a9f205.js" defer></script><script src="/reading-notes/assets/js/vendors~layout-Layout.5a15940e.js" defer></script><script src="/reading-notes/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.7c754536.js" defer></script><script src="/reading-notes/assets/js/page-SOLID.774414f8.js" defer></script><script src="/reading-notes/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.3cdde019.js" defer></script><script src="/reading-notes/assets/js/37.5a75d47b.js" defer></script>
  </body>
</html>
