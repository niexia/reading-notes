<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>单例模式 | Reading Notes</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/reading-notes/favicon.ico">
    <link rel="manifest" href="/reading-notes/manifest.webmanifest" crossorigin="use-credentials">
    <meta name="description" content="写点啦!">
    <meta property="og:url" content="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern.html">
    <meta property="og:site_name" content="Reading Notes">
    <meta property="og:title" content="单例模式">
    <meta property="og:description" content="单例模式 经典的设计模式有 23 种，不过常用的可能都不到一半。先看一下单例模式，重点是搞清楚几个问题： 为什么要使用单例？; 单例存在哪些问题？; 单例与静态类的区别？; 有何替代的解决方案？; 为什么要使用单例 什么是单实例 " 单例设计模式（Singleton Design Pattern）理解起来非常简单。一个类只允许创建一个对象（或者实例），那这个">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="Reading Notes">
    <meta name="theme-color" content="#46bd87">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <link rel="preload" href="/reading-notes/assets/css/0.styles.9772cc4e.css" as="style"><link rel="preload" href="/reading-notes/assets/js/app.3d0c3830.js" as="script"><link rel="preload" href="/reading-notes/assets/js/vendors~layout-Layout.3c40cc25.js" as="script"><link rel="preload" href="/reading-notes/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.9b90199b.js" as="script"><link rel="preload" href="/reading-notes/assets/js/page-单例模式.6f5c4f9a.js" as="script"><link rel="preload" href="/reading-notes/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.c1acbf4e.js" as="script"><link rel="prefetch" href="/reading-notes/assets/js/3.0745fba9.js"><link rel="prefetch" href="/reading-notes/assets/js/75.8c821b23.js"><link rel="prefetch" href="/reading-notes/assets/js/76.73f957df.js"><link rel="prefetch" href="/reading-notes/assets/js/layout-Blog.dcc5ff84.js"><link rel="prefetch" href="/reading-notes/assets/js/layout-Layout.ea688dcf.js"><link rel="prefetch" href="/reading-notes/assets/js/layout-NotFound.35ec045b.js"><link rel="prefetch" href="/reading-notes/assets/js/layout-Slide.10a11898.js"><link rel="prefetch" href="/reading-notes/assets/js/page--25410731.9377dc9a.js"><link rel="prefetch" href="/reading-notes/assets/js/page--3992e0e1.7770daa0.js"><link rel="prefetch" href="/reading-notes/assets/js/page--44a0de64.b8858835.js"><link rel="prefetch" href="/reading-notes/assets/js/page--4855b8f6.a9e2ded1.js"><link rel="prefetch" href="/reading-notes/assets/js/page--5f87f751.d32c1e05.js"><link rel="prefetch" href="/reading-notes/assets/js/page--7507ab0e.7f395923.js"><link rel="prefetch" href="/reading-notes/assets/js/page--ac2b465e.db67aa41.js"><link rel="prefetch" href="/reading-notes/assets/js/page--d1e0c466.043bf8e0.js"><link rel="prefetch" href="/reading-notes/assets/js/page-BF算法和RK算法.7b0b5cee.js"><link rel="prefetch" href="/reading-notes/assets/js/page-DRY.054b15af.js"><link rel="prefetch" href="/reading-notes/assets/js/page-KISS.95240a5c.js"><link rel="prefetch" href="/reading-notes/assets/js/page-LOD.765ae0ff.js"><link rel="prefetch" href="/reading-notes/assets/js/page-SOLID.57395655.js"><link rel="prefetch" href="/reading-notes/assets/js/page-Tire树.a0827513.js"><link rel="prefetch" href="/reading-notes/assets/js/page-YAGNI.f665b05d.js"><link rel="prefetch" href="/reading-notes/assets/js/page-专业主义.13edd1bc.js"><link rel="prefetch" href="/reading-notes/assets/js/page-为什么要用金字塔原理.a7f06067.js"><link rel="prefetch" href="/reading-notes/assets/js/page-为什么需要学习掌握设计模式相关知识.6d13f262.js"><link rel="prefetch" href="/reading-notes/assets/js/page-了解架构设计.2c111cce.js"><link rel="prefetch" href="/reading-notes/assets/js/page-二分查找.d9b11f3c.js"><link rel="prefetch" href="/reading-notes/assets/js/page-二分查找的变形.9479bbca.js"><link rel="prefetch" href="/reading-notes/assets/js/page-二叉查找树.64abb029.js"><link rel="prefetch" href="/reading-notes/assets/js/page-二叉树.b151b4e6.js"><link rel="prefetch" href="/reading-notes/assets/js/page-介绍.08d9a9c7.js"><link rel="prefetch" href="/reading-notes/assets/js/page-从0开始学架构.48c7b249.js"><link rel="prefetch" href="/reading-notes/assets/js/page-代码整洁之道-程序员的职业素养.1018d673.js"><link rel="prefetch" href="/reading-notes/assets/js/page-冒泡、插入和选择排序.a855a251.js"><link rel="prefetch" href="/reading-notes/assets/js/page-分治算法.c8fc8927.js"><link rel="prefetch" href="/reading-notes/assets/js/page-前言.f79e82e9.js"><link rel="prefetch" href="/reading-notes/assets/js/page-动态规划.b9d3f2e2.js"><link rel="prefetch" href="/reading-notes/assets/js/page-原型模式.6c3dcd61.js"><link rel="prefetch" href="/reading-notes/assets/js/page-哈希算法.c1287d40.js"><link rel="prefetch" href="/reading-notes/assets/js/page-回溯算法.01c8cf35.js"><link rel="prefetch" href="/reading-notes/assets/js/page-图.e78a1047.js"><link rel="prefetch" href="/reading-notes/assets/js/page-堆.84abe625.js"><link rel="prefetch" href="/reading-notes/assets/js/page-堆的应用.41a64e7f.js"><link rel="prefetch" href="/reading-notes/assets/js/page-实战.6073968f.js"><link rel="prefetch" href="/reading-notes/assets/js/page-工厂模式.77e60ab9.js"><link rel="prefetch" href="/reading-notes/assets/js/page-建造者模式.5de1b6ae.js"><link rel="prefetch" href="/reading-notes/assets/js/page-归并排序和快速排序.92f024f4.js"><link rel="prefetch" href="/reading-notes/assets/js/page-手写链表的技巧.c0016eb4.js"><link rel="prefetch" href="/reading-notes/assets/js/page-排序.8033a9be.js"><link rel="prefetch" href="/reading-notes/assets/js/page-排序优化.df2d2d0f.js"><link rel="prefetch" href="/reading-notes/assets/js/page-散列表.51a8696b.js"><link rel="prefetch" href="/reading-notes/assets/js/page-数组.481973b1.js"><link rel="prefetch" href="/reading-notes/assets/js/page-栈.6e8010a5.js"><link rel="prefetch" href="/reading-notes/assets/js/page-桶排序、计数排序和基数排序.282f3faa.js"><link rel="prefetch" href="/reading-notes/assets/js/page-深度优先和广度优先搜索.87c3b384.js"><link rel="prefetch" href="/reading-notes/assets/js/page-硅谷钢铁侠.5174d838.js"><link rel="prefetch" href="/reading-notes/assets/js/page-系统复杂度的来源.047b8c22.js"><link rel="prefetch" href="/reading-notes/assets/js/page-红黑树.e1b3897a.js"><link rel="prefetch" href="/reading-notes/assets/js/page-练习.125689fb.js"><link rel="prefetch" href="/reading-notes/assets/js/page-设计散列表.e6a33281.js"><link rel="prefetch" href="/reading-notes/assets/js/page-说不.0ab859c8.js"><link rel="prefetch" href="/reading-notes/assets/js/page-说是.ad92f1fd.js"><link rel="prefetch" href="/reading-notes/assets/js/page-贪心算法.55369e31.js"><link rel="prefetch" href="/reading-notes/assets/js/page-跳表.862ba8b3.js"><link rel="prefetch" href="/reading-notes/assets/js/page-递归.aaa23242.js"><link rel="prefetch" href="/reading-notes/assets/js/page-重构.1fea2347.js"><link rel="prefetch" href="/reading-notes/assets/js/page-金字塔原理.80a4ca29.js"><link rel="prefetch" href="/reading-notes/assets/js/page-链表.6233cc25.js"><link rel="prefetch" href="/reading-notes/assets/js/page-队列.a139af23.js"><link rel="prefetch" href="/reading-notes/assets/js/page-面向对象是什么.e8cb31ee.js"><link rel="prefetch" href="/reading-notes/assets/js/vendors~photo-swipe.51c22c18.js">
    <link rel="stylesheet" href="/reading-notes/assets/css/0.styles.9772cc4e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/reading-notes/" class="home-link router-link-active"><!----> <!----> <span class="site-name can-hide">Reading Notes</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">Theme Color:</label> <li><span class="default-theme"></span></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">Theme Mode:</label> <div class="darkmode-switch"><div class="item day"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon light-icon"><path d="M512 256a42.667 42.667 0 0 0 42.667-42.667V128a42.667 42.667 0 0 0-85.334 0v85.333A42.667 42.667 0 0 0 512 256zm384 213.333h-85.333a42.667 42.667 0 0 0 0 85.334H896a42.667 42.667 0 0 0 0-85.334zM256 512a42.667 42.667 0 0 0-42.667-42.667H128a42.667 42.667 0 0 0 0 85.334h85.333A42.667 42.667 0 0 0 256 512zm9.387-298.667a42.667 42.667 0 0 0-59.307 62.72l61.44 59.307a42.667 42.667 0 0 0 31.147 11.947 42.667 42.667 0 0 0 30.72-13.227 42.667 42.667 0 0 0 0-60.16zm459.946 133.974a42.667 42.667 0 0 0 29.44-11.947l61.44-59.307a42.667 42.667 0 0 0-57.6-62.72l-61.44 60.587a42.667 42.667 0 0 0 0 60.16 42.667 42.667 0 0 0 28.16 13.227zM512 768a42.667 42.667 0 0 0-42.667 42.667V896a42.667 42.667 0 0 0 85.334 0v-85.333A42.667 42.667 0 0 0 512 768zm244.48-79.36a42.667 42.667 0 0 0-59.307 61.44l61.44 60.587a42.667 42.667 0 0 0 29.44 11.946 42.667 42.667 0 0 0 30.72-12.8 42.667 42.667 0 0 0 0-60.586zm-488.96 0-61.44 59.307a42.667 42.667 0 0 0 0 60.586 42.667 42.667 0 0 0 30.72 12.8 42.667 42.667 0 0 0 28.587-10.666l61.44-59.307a42.667 42.667 0 0 0-59.307-61.44zM512 341.333A170.667 170.667 0 1 0 682.667 512 170.667 170.667 0 0 0 512 341.333z" fill="currentColor"></path></svg></div> <div class="item auto active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon auto-icon"><path d="M460.864 539.072H564.8L510.592 376l-49.728 163.072zM872 362.368V149.504H659.648L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352V661.376l149.12-149.504L872 362.368zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624h-85.888l144.576-407.68h90.368l144.576 407.68h-85.824zm0 0" fill="currentColor"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon dark-icon"><path d="M935.539 630.402c-11.43-11.432-28.674-14.739-43.531-8.354-46.734 20.103-96.363 30.297-147.508 30.297-99.59 0-193.221-38.784-263.64-109.203-108.637-108.637-139.61-270.022-78.908-411.148a39.497 39.497 0 0 0-51.886-51.887c-52.637 22.64-100.017 54.81-140.826 95.616-85.346 85.346-132.346 198.821-132.346 319.52 0 120.7 47.001 234.172 132.347 319.519S408.063 947.11 528.76 947.11c120.7 0 234.172-47.003 319.52-132.351 40.809-40.81 72.978-88.19 95.616-140.826a39.497 39.497 0 0 0-8.356-43.532z" fill="currentColor"></path></svg></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="目录" class="dropdown-title"><span class="title"><!---->
        目录
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>🧑🏻‍💻 技术</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/reading-notes/algo/" class="nav-link"><!---->
  数据结构和算法之美
</a></li><li class="dropdown-subitem"><a href="/reading-notes/the-beauty-of-design-patterns/" class="nav-link router-link-active active"><!---->
  设计模式之美
</a></li><li class="dropdown-subitem"><a href="/reading-notes/learn-architecture-from-zero/" class="nav-link"><!---->
  从0开始学架构
</a></li><li class="dropdown-subitem"><a href="/reading-notes/the-clean-coder/" class="nav-link"><!---->
  代码整洁之道|程序员的职业素养
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>🎯 综合能力</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/reading-notes/the-minto-pyramid-principle/" class="nav-link"><!---->
  金字塔原理
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>🥤 人物传记</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/reading-notes/elon-musk/" class="nav-link"><!---->
  硅谷钢铁侠
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://niexia.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  个人博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div></nav> <!----> <a rel="noopener noreferrer" href="https://github.com/niexia/reading-notes" target="_blank" class="repo-link can-hide">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!----> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="目录" class="dropdown-title"><span class="title"><!---->
      目录
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>🧑🏻‍💻 技术</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/reading-notes/algo/" class="nav-link"><!---->
  数据结构和算法之美
</a></li><li class="dropdown-subitem"><a href="/reading-notes/the-beauty-of-design-patterns/" class="nav-link router-link-active active"><!---->
  设计模式之美
</a></li><li class="dropdown-subitem"><a href="/reading-notes/learn-architecture-from-zero/" class="nav-link"><!---->
  从0开始学架构
</a></li><li class="dropdown-subitem"><a href="/reading-notes/the-clean-coder/" class="nav-link"><!---->
  代码整洁之道|程序员的职业素养
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>🎯 综合能力</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/reading-notes/the-minto-pyramid-principle/" class="nav-link"><!---->
  金字塔原理
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>🥤 人物传记</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/reading-notes/elon-musk/" class="nav-link"><!---->
  硅谷钢铁侠
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://niexia.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  个人博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a rel="noopener noreferrer" href="https://github.com/niexia/reading-notes" target="_blank" class="repo-link">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <!----> <div class="content__sidebar-center"></div> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><!----> <span class="title">面向对象</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/reading-notes/the-beauty-of-design-patterns/object-oriented/what-is-object-oriented/" class="sidebar-link">面向对象是什么</a></li><li><a href="/reading-notes/the-beauty-of-design-patterns/object-oriented/practice/" class="sidebar-link">实战</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><!----> <span class="title">设计原则</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/SOLID/" class="sidebar-link">SOLID</a></li><li><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/KISS/" class="sidebar-link">KISS</a></li><li><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/YAGNI/" class="sidebar-link">YAGNI</a></li><li><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/DRY/" class="sidebar-link">DRY</a></li><li><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/LOD/" class="sidebar-link">LOD</a></li><li><a href="/reading-notes/the-beauty-of-design-patterns/design-principles/practice/" class="sidebar-link">/the-beauty-of-design-patterns/design-principles/practice/</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><!----> <span class="title">规范与重构</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/reading-notes/the-beauty-of-design-patterns/standard-refactor/refactor/" class="sidebar-link">重构</a></li><li><a href="/reading-notes/the-beauty-of-design-patterns/standard-refactor/standard/" class="sidebar-link">/the-beauty-of-design-patterns/standard-refactor/standard/</a></li><li><a href="/reading-notes/the-beauty-of-design-patterns/standard-refactor/practice/" class="sidebar-link">/the-beauty-of-design-patterns/standard-refactor/practice/</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><!----> <span class="title">设计模式</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><!----> <span class="title">创建型</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/" aria-current="page" class="active sidebar-link">单例模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/#为什么要使用单例" class="sidebar-link">为什么要使用单例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/#什么是单实例" class="sidebar-link heading3">什么是单实例</a></li><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/#用处" class="sidebar-link heading3">用处</a></li></ul></li><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/#单实例的实现" class="sidebar-link">单实例的实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/#饿汉式" class="sidebar-link heading3">饿汉式</a></li><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/#懒汉式" class="sidebar-link heading3">懒汉式</a></li><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/#双重检测" class="sidebar-link heading3">双重检测</a></li></ul></li><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/#单例模式存在的问题" class="sidebar-link">单例模式存在的问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/#单例对-oop-特性的支持不友好" class="sidebar-link heading3">单例对 OOP 特性的支持不友好</a></li><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/#单例会隐藏类之间的依赖关系" class="sidebar-link heading3">单例会隐藏类之间的依赖关系</a></li><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/#单例对代码的扩展性不友好" class="sidebar-link heading3">单例对代码的扩展性不友好</a></li><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/#单例对代码的可测试性不友好" class="sidebar-link heading3">单例对代码的可测试性不友好</a></li><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/#单例不支持有参数的构造函数" class="sidebar-link heading3">单例不支持有参数的构造函数</a></li></ul></li><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/#有何替代解决方案" class="sidebar-link">有何替代解决方案</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/#使用静态方法可以吗" class="sidebar-link heading3">使用静态方法可以吗</a></li><li class="sidebar-sub-header"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/#通过依赖注入呢" class="sidebar-link heading3">通过依赖注入呢</a></li></ul></li></ul></li><li><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/factory-design-pattern/" class="sidebar-link">工厂模式</a></li><li><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/builder-pattern/" class="sidebar-link">建造者模式</a></li><li><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/prototype-design-pattern/" class="sidebar-link">原型模式</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><!----> <span class="title">结构型</span> <!----></p> <!----></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><!----> <span class="title">行为型</span> <!----></p> <!----></section></li></ul></section></li></ul> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb"><ol vocab="https://schema.org/" typeof="BreadcrumbList"><li property="itemListElement" typeof="ListItem"><a href="/reading-notes/the-beauty-of-design-patterns/" property="item" typeof="WebPage" class="router-link-active"><!----> <span property="name">为什么需要学习掌握设计模式相关知识</span></a> <meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem" class="is-active"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/" aria-current="page" property="item" typeof="WebPage" class="router-link-exact-active router-link-active"><!----> <span property="name">单例模式</span></a> <meta property="position" content="2"></li></ol></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">单例模式</span></h1> <div class="page-info"><!----> <!----><!----><span aria-label="Writing Date📅" data-balloon-pos="down" class="time-info"><svg viewBox="0 0 1030 1024" xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H180.6A134.314 134.314 0 0 0 46.66 277.595v535.756A134.314 134.314 0 0 0 180.6 947.289h669.74a134.36 134.36 0 0 0 133.94-133.938V277.595a134.314 134.314 0 0 0-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 0 1-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 0 1-33.472 33.473z" fill="currentColor"></path></svg> <span property="datePublished">2022-6-5</span></span><!----><!----><span aria-label="Reading Time⌛" data-balloon-pos="down" class="reading-time-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon timer-icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z" fill="currentColor"></path></svg> <span>About 13 min</span> <meta property="timeRequired" content="PT13M"></span></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/#为什么要使用单例" class="anchor-link heading2"><div>为什么要使用单例</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/#什么是单实例" class="anchor-link heading3"><div>什么是单实例</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/#用处" class="anchor-link heading3"><div>用处</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/#单实例的实现" class="anchor-link heading2"><div>单实例的实现</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/#饿汉式" class="anchor-link heading3"><div>饿汉式</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/#懒汉式" class="anchor-link heading3"><div>懒汉式</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/#双重检测" class="anchor-link heading3"><div>双重检测</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/#单例模式存在的问题" class="anchor-link heading2"><div>单例模式存在的问题</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/#单例对-oop-特性的支持不友好" class="anchor-link heading3"><div>单例对 OOP 特性的支持不友好</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/#单例会隐藏类之间的依赖关系" class="anchor-link heading3"><div>单例会隐藏类之间的依赖关系</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/#单例对代码的扩展性不友好" class="anchor-link heading3"><div>单例对代码的扩展性不友好</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/#单例对代码的可测试性不友好" class="anchor-link heading3"><div>单例对代码的可测试性不友好</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/#单例不支持有参数的构造函数" class="anchor-link heading3"><div>单例不支持有参数的构造函数</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/#有何替代解决方案" class="anchor-link heading2"><div>有何替代解决方案</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/#使用静态方法可以吗" class="anchor-link heading3"><div>使用静态方法可以吗</div></a></li><li class="anchor"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern/#通过依赖注入呢" class="anchor-link heading3"><div>通过依赖注入呢</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><h1 id="单例模式"><a href="#单例模式" class="header-anchor">#</a> 单例模式</h1> <p>经典的设计模式有 23 种，不过常用的可能都不到一半。先看一下单例模式，重点是搞清楚几个问题：</p> <ul><li>为什么要使用单例？</li> <li>单例存在哪些问题？</li> <li>单例与静态类的区别？</li> <li>有何替代的解决方案？</li></ul> <h2 id="为什么要使用单例"><a href="#为什么要使用单例" class="header-anchor">#</a> 为什么要使用单例</h2> <h3 id="什么是单实例"><a href="#什么是单实例" class="header-anchor">#</a> 什么是单实例</h3> <blockquote><p>单例设计模式（Singleton Design Pattern）理解起来非常简单。<strong>一个类只允许创建一个对象</strong>（或者实例），那这个类就是一个单例类，这种设计模式就叫作单例设计模式，简称单例模式。</p></blockquote> <h3 id="用处"><a href="#用处" class="header-anchor">#</a> 用处</h3> <p>从概念上看，有些数据在系统中应该只保存一份，就比较合适设计为单例类，比如系统配置信息。除此之外，还可以用单例解决资源访问冲突的问题。</p> <h4 id="表示全局唯一类"><a href="#表示全局唯一类" class="header-anchor">#</a> 表示全局唯一类</h4> <ul><li>比如配置信息</li></ul> <p>在我们系统中，我们只有一个配置文件，当配置文件被加载到内存之后，以对象的形式存在，也应当只有一份。</p> <ul><li>比如唯一递增 ID 号码生成器</li></ul> <p>如果程序中有两个对象，那么就会存在重复 ID 的情况，所以我们应该将 ID 生成器设计为单例的。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// 模拟一下 AtomicLong</span>
<span class="token comment">// AtomicLong是一个Java并发库中提供的一个原子变量类型,</span>
<span class="token comment">// 它将一些线程不安全需要加锁的复合操作封装为了线程安全的原子操作， </span>
<span class="token comment">// 比如下面会用到的incrementAndGet()</span>
<span class="token keyword">class</span> <span class="token class-name">AtomicLong</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span>initNumber<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> initNumber<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">IdGenerator</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> id <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicLong</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IdGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> IdGenerator<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> id1 <span class="token operator">=</span> IdGenerator<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> id2 <span class="token operator">=</span> IdGenerator<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> id3 <span class="token operator">=</span> IdGenerator<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>id1<span class="token punctuation">,</span> id2<span class="token punctuation">,</span> id3<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h4 id="处理资源访问冲突"><a href="#处理资源访问冲突" class="header-anchor">#</a> 处理资源访问冲突</h4> <blockquote><p>主要在服务端多线程的情况下，这里了解一下相关知识点/背景</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Logger</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">FileWriter</span> writer<span class="token punctuation">;</span>
  
  <span class="token keyword">public</span> <span class="token class-name">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;/Users/wangzheng/log.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    writer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileWriter</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//true表示追加写入</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Logger类的应用示例：</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...省略业务逻辑代码...</span>
    logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>username <span class="token operator">+</span> <span class="token string">&quot; logined!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderController</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">OrderVo</span> order<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...省略业务逻辑代码...</span>
    logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Created an order: &quot;</span> <span class="token operator">+</span> order<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><ul><li><strong>存在的问题</strong></li></ul> <p>会出现互相覆盖。分别创建两个 log 对象，在 Web 容器的 Servlet <strong>多线程环境下</strong>，如果两个 Servlet 线程同时分别执行 login() 和 create() 两个函数，并且同时写日志到 log.txt 文件中，可能会互相覆盖。</p> <p><img src="/reading-notes/assets/img/design-patterns-multi-threaded.25d492c5.png" alt=""></p> <ul><li><strong>解决方法</strong></li></ul> <ol><li>加锁：给 log() 函数加互斥锁</li></ol> <div class="language-java line-numbers-mode"><pre class="language-java"><code>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Logger</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">FileWriter</span> writer<span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token class-name">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;/Users/wangzheng/log.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    writer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileWriter</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//true表示追加写入</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>mesasge<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>但是不能解决问题。这种琐是对象级别的，<strong>一个对象在不同的线程下同时调用 log() 函数，会被强制要求顺序执行。但是，不同的对象之间并不共享同一把锁</strong>。</p> <p><img src="/reading-notes/assets/img/design-patterns-multi-threaded-safe.c0878bab.png" alt=""></p> <ol><li>把对象级别的锁，换成类级别的锁</li></ol> <p>解决前面的问题，我们缓存类级别的锁就行，避免不同对象同时调用 log 函数。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Logger</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">FileWriter</span> writer<span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token class-name">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;/Users/wangzheng/log.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    writer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileWriter</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//true表示追加写入</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token class-name">Logger</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 类级别的锁</span>
      writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>mesasge<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>除了前面的方式，解决资源竞争的方法还有分布式锁、并发队列（多个线程往并发队列写日志，一个单独线程负责将并发队列中的数据写入日志文件）。</p> <p>不过这些方式都比较复杂。</p> <ol start="3"><li>使用单例</li></ol> <p>单例的思路比较简单，另外相比于锁有一些好处：不用创建那么多 Logger 对象，一方面<strong>节省内存空间</strong>，另一方面节省系统文件句柄（对于操作系统来说，文件句柄也是一种资源，不能随便浪费）</p> <p>我们将 Logger 设计成一个单例类，程序中只允许创建一个 Logger 对象，所有的线程共享使用的这一个 Logger 对象，共享一个 FileWriter 对象，而 FileWriter 本身是对象级别线程安全的，就避免覆盖的问题。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Logger</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> FileWriter writer<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> final Logger instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">private</span> <span class="token function">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    File file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;/Users/wangzheng/log.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    writer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileWriter</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//true表示追加写入</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">public</span> <span class="token keyword">static</span> Logger <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">log</span><span class="token punctuation">(</span>String message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>mesasge<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Logger类的应用示例：</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">login</span><span class="token punctuation">(</span>String username<span class="token punctuation">,</span> String password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...省略业务逻辑代码...</span>
    Logger<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>username <span class="token operator">+</span> <span class="token string">&quot; logined!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderController</span> <span class="token punctuation">{</span>  
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">create</span><span class="token punctuation">(</span>OrderVo order<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...省略业务逻辑代码...</span>
    Logger<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Created a order: &quot;</span> <span class="token operator">+</span> order<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h2 id="单实例的实现"><a href="#单实例的实现" class="header-anchor">#</a> 单实例的实现</h2> <p>概括起来，要实现一个单例，我们需要关注的点无外乎下面几个：</p> <ul><li>构造函数需要是 private 访问权限的，这样才能避免外部通过 new 创建实例；</li> <li>考虑对象创建时的线程安全问题；</li> <li>考虑是否支持延迟加载；</li> <li>考虑 getInstance() 性能是否高（是否加锁）</li></ul> <h3 id="饿汉式"><a href="#饿汉式" class="header-anchor">#</a> 饿汉式</h3> <p>在类加载的时候，instance 静态实例就已经创建并初始化好了，所以，instance 实例的创建过程<strong>是线程安全</strong>的。不过，这样的实现方式<strong>不支持延迟加载</strong>（在真正用到 IdGenerator 的时候，再创建实例）</p> <p>从名字也可以看出来。具体实现如下：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>
  <span class="token comment">// 构造函数需要是 private 访问权限的</span>
  <span class="token keyword">private</span> <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">// 类内部创建对象实例化</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> instance<span class="token operator">:</span> Singleton <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 提供一个公有的静态方法，返回实例对象</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Singleton <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> id <span class="token operator">=</span> Singleton<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>有人觉得这种实现方式不好，因为不支持延迟加载，如果实例占用资源多（比如占用内存多）或初始化耗时长（比如需要加载各种配置文件），<strong>提前初始化实例是一种浪费资源的行为</strong>。最好的方法应该在用到的时候再去初始化。</p> <p>不认同这样的观点：</p> <ul><li><p>初始化耗时长：那最好不要等到用到再初始化，这样会影响系统性能（例如响应客户请求的时候去初始化，就可能导致超时）。采用饿汉式实现方式，将耗时的初始化操作，提前到程序启动的时候完成，这样就能避免在程序运行的时候，再去初始化导致的性能问题。</p></li> <li><p>实例占用资源多：按照 fail-fast 的设计原则（<strong>有问题及早暴露</strong>），那我们也希望在程序启动时就将这个实例初始化好。如果资源不够，就会在程序启动的时候触发报错，可以立即去修复。而不是系统中途去初始化占用资源过多，导致崩溃</p></li></ul> <h3 id="懒汉式"><a href="#懒汉式" class="header-anchor">#</a> 懒汉式</h3> <p>对应的，就有懒汉式。懒汉式相对于饿汉式的优势是<strong>支持延迟加载</strong>。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>
  <span class="token comment">// 先不实例化</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> instance<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 使用前再判断</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>instance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Singleton<span class="token punctuation">.</span>instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> Singleton<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>不过懒汉式的缺点也很明显。<strong>就是线程安全的问题</strong>，如果被多个线程调用，会容易创建出多个实例，所以需要给 getInstance 加锁。</p> <p>但是加锁之后会带来新的问题：<strong>导致这个函数的并发度很低</strong>。量化一下的话，并发度是 1，也就相当于串行操作了。而这个函数是在单例使用期间，一直会被调用。如果这个单例类偶尔会被用到，那这种实现方式还可以接受。但是，如果频繁地用到，那频繁加锁、释放锁及并发度低等问题，会导致性能瓶颈，这种实现方式就不可取了。</p> <p><strong>js 是基于单线程运行代码，所以不存在线程不安全问题，推荐该种方法</strong></p> <h3 id="双重检测"><a href="#双重检测" class="header-anchor">#</a> 双重检测</h3> <p>饿汉式不支持延迟加载，懒汉式有性能问题，不支持高并发。再来看一种既支持延迟加载、又支持高并发的单例实现方式，也就是双重检测实现方式。</p> <p>和懒汉式的区别就是，<strong>把方法锁改成类锁</strong>。这样只要 instance 创建之后，再调用 getInstance 也不会有加锁的逻辑。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IdGenerator</span> <span class="token punctuation">{</span> 
  <span class="token keyword">private</span> <span class="token class-name">AtomicLong</span> id <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicLong</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">IdGenerator</span> instance<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">IdGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token comment">// public static synchronized IdGenerator getInstance()</span>
  <span class="token comment">// =&gt;</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">IdGenerator</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token class-name">IdGenerator</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 此处为类级别的锁</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IdGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword">return</span> id<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h2 id="单例模式存在的问题"><a href="#单例模式存在的问题" class="header-anchor">#</a> 单例模式存在的问题</h2> <p>尽管单例模式是一个很常用的模式，但是有些人认为单例是一种反模式（anti-pattern），并不推荐使用。</p> <p>那么单例这种设计模式存在哪些问题？为什么会被称为反模式？如果不用单例，该如何表示全局唯一类？有何替代的解决方案？</p> <h3 id="单例对-oop-特性的支持不友好"><a href="#单例对-oop-特性的支持不友好" class="header-anchor">#</a> 单例对 OOP 特性的支持不友好</h3> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">class</span> <span class="token class-name">Order</span> <span class="token punctuation">{</span>
  <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> IdGenerator<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
  <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> IdGenerator<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>IdGenerator 的使用方式<strong>违背了基于接口而非实现的设计原则</strong>，也就违背了广义上理解的 OOP 的抽象特性。</p> <p>如果某一天，我们希望针对不同的业务采用不同的生成算法，<strong>那么就需要修改所有用到 IdGenerator 类的地方，代码改动就会比较大</strong>。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">class</span> <span class="token class-name">Order</span> <span class="token punctuation">{</span>
  <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> IdGenerator<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 替换成 =&gt;</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> OrderIdGenerator<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
  <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> IdGenerator<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 替换成 =&gt;</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> UserIdGenerator<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>除此之外，单例对继承、多态特性的支持也不友好。所以一旦选择设计为单例类，就意味着放弃继承和多态这两个强有力的面向对象的特性。</p> <h3 id="单例会隐藏类之间的依赖关系"><a href="#单例会隐藏类之间的依赖关系" class="header-anchor">#</a> 单例会隐藏类之间的依赖关系</h3> <p>在阅读代码的时候，我们希望<strong>一眼就能看出</strong>类与类之间的依赖关系，搞清楚这个类依赖了哪些外部类。</p> <p>通过<strong>构造函数</strong>、<strong>参数传递</strong>等方式声明类之间的依赖关系，我们直接可以通过函数的定义就可很容易识别出来。但是单例类不需要显示创建、不依赖参数传递，直接调用就可以，这种调用关系会比较隐蔽。阅读代码的时候仔细查看每个函数的实现才知道到底这个类依赖了哪些类。</p> <h3 id="单例对代码的扩展性不友好"><a href="#单例对代码的扩展性不友好" class="header-anchor">#</a> 单例对代码的扩展性不友好</h3> <p>单例类只有一个对象实例，如果有一天我们需要两个或者多个实例类，那怎么办呢？</p> <p>比如数据库连接池，初期我们认为系统中应该只有一个连接池，这样方便我们控制对数据库连接资源的消耗，所以设计成单例类。</p> <p>但是之后发现，有些 SQL 会很慢，它们长时间占用数据库连接资源会导致其他 SQL 无法响应。希望将慢 SQL 和其他 SQL 分开。为了实现这个目标就需要创建两个数据库连接池了。</p> <p>这个时候最初的单例类就无法满足这样的需求，也就是说单例类在某些情况下会影响扩展性、灵活性。</p> <h3 id="单例对代码的可测试性不友好"><a href="#单例对代码的可测试性不友好" class="header-anchor">#</a> 单例对代码的可测试性不友好</h3> <ul><li>无法 mock：如果单例类依赖比较重的外部资源，比如 DB，那么写单测的时候一般会通过 mock 来将它替换，但是单实例这种硬编码的方式导致无法 mock。</li> <li>成员变量类似全局变量：单例类持有成员变量（例如 IdGenerator 的 id），相当于全局变量，被所有代码共享，我们写单测的时候还需要考虑不同用例之间的影响。</li></ul> <h3 id="单例不支持有参数的构造函数"><a href="#单例不支持有参数的构造函数" class="header-anchor">#</a> 单例不支持有参数的构造函数</h3> <p>单例不支持有参数的构造函数，比如我们创建一个连接池的单例对象，我们没法通过参数来指定连接池的大小。</p> <p>解决的方法：</p> <ul><li>第一种方法：创建实例之后，在使用前，通过调用 init() 函数传递参数。</li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>
  <span class="token comment">// 先不实例化</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> instance<span class="token punctuation">;</span>
  <span class="token keyword">private</span> paramA<span class="token punctuation">;</span>
  <span class="token keyword">private</span> paramB
  <span class="token keyword">private</span> <span class="token function">constructor</span> <span class="token punctuation">(</span>paramA<span class="token punctuation">,</span> paramB<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>paramA <span class="token operator">=</span> paramA<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>paramB <span class="token operator">=</span> paramB<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 使用前再判断</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>instance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Run init first.'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> Singleton<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token function">init</span><span class="token punctuation">(</span>paramA<span class="token punctuation">,</span> paramB<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Singleton<span class="token punctuation">.</span>instance <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Singleton has been created!'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    Singleton<span class="token punctuation">.</span>instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span>paramA<span class="token punctuation">,</span> paramB<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> Singleton<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><ul><li>第二种方法：将参数放到 getInstance() 方法中</li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>
  <span class="token comment">// 先不实例化</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> instance<span class="token punctuation">;</span>
  <span class="token keyword">private</span> paramA<span class="token punctuation">;</span>
  <span class="token keyword">private</span> paramB
  <span class="token keyword">private</span> <span class="token function">constructor</span> <span class="token punctuation">(</span>paramA<span class="token punctuation">,</span> paramB<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>paramA <span class="token operator">=</span> paramA<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>paramB <span class="token operator">=</span> paramB<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token function">getInstance</span><span class="token punctuation">(</span>paramA<span class="token punctuation">,</span> paramB<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 使用前再判断</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>instance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Singleton<span class="token punctuation">.</span>instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span>paramA<span class="token punctuation">,</span> paramB<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> Singleton<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>但是这种方法，当我们执行两次的时候第二次是不生效的，另外在构建过程中也没有给予提示，容易误导用户。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> instance1 <span class="token operator">=</span> Singleton<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> instance2 <span class="token operator">=</span> Singleton<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 配置实际没有生效</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>要解决这个问题可以提供一个 update 方法</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  <span class="token keyword">public</span> <span class="token function">updateConfig</span><span class="token punctuation">(</span>paramA<span class="token punctuation">,</span> paramB<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Singleton<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>paramA <span class="token operator">=</span> paramA<span class="token punctuation">;</span>
    Singleton<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>paramB <span class="token operator">=</span> paramB<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>第三种方法：讲参数放到另外一个全局变量。</li></ul> <p>下面通过静态常量来定义。也可以从配置文件中加载得到。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">class</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> paramA <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> paramB <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>
  <span class="token comment">// 先不实例化</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> instance<span class="token punctuation">;</span>
  <span class="token keyword">private</span> paramA<span class="token punctuation">;</span>
  <span class="token keyword">private</span> paramB
  <span class="token keyword">private</span> <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>paramA <span class="token operator">=</span> Config<span class="token punctuation">.</span>paramA<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>paramB <span class="token operator">=</span> Config<span class="token punctuation">.</span>paramB<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 使用前再判断</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>instance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Singleton<span class="token punctuation">.</span>instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> Singleton<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h2 id="有何替代解决方案"><a href="#有何替代解决方案" class="header-anchor">#</a> 有何替代解决方案</h2> <p>即便单例有这么多问题，但是不用不行啊，业务上有表示全局唯一类的需求。如果不用单例，怎么解决这个问题呢？</p> <h3 id="使用静态方法可以吗"><a href="#使用静态方法可以吗" class="header-anchor">#</a> 使用静态方法可以吗</h3> <p>为了保证全局唯一，除了使用单例，还可以使用 静态方法来实现。这也是项目开发中经常用到的一种实现思路。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">class</span> <span class="token class-name">IdGenerator</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> id <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicLong</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> id<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用</span>
<span class="token keyword">const</span> id <span class="token operator">=</span> IdGenerator<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>不过静态方法并不能解决之前提到的问题。实际上，<strong>它比单例更加不灵活</strong>，比如，它无法支持延迟加载。</p> <h3 id="通过依赖注入呢"><a href="#通过依赖注入呢" class="header-anchor">#</a> 通过依赖注入呢</h3> <p>单例除了前面的使用方式之外，还有另外一种方法，具体的代码如下：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// 老的使用方式</span>
<span class="token keyword">function</span> <span class="token function">demoFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> IdGenerator<span class="token punctuation">.</span>getInstance<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 新的使用方式：依赖注入</span>
<span class="token keyword">function</span> <span class="token function">demoFunction</span><span class="token punctuation">(</span>idGenerator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> idGenerator<span class="token punctuation">.</span>getId<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 调用时将 idGenerator 传入</span>
<span class="token keyword">const</span> idGenerator <span class="token operator">=</span> IdGenerator<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">demoFunction</span><span class="token punctuation">(</span>idGenerator<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>通过依赖注入的方式，可以寄解决单例隐藏类之间依赖关系的问题。不过，对单例存在的其他问题，比如 OOP 特性、扩展性、可测试性不友好的问题，还是无法解决。</p> <p><strong>如果要完全解决这些问题，我们可能要从根本上，寻找其他方式来实现全局唯一的类</strong>。实际上，类对象的全局唯一性可以通过多种不同的方式来保证：</p> <ul><li>我们既可以通过单例模式来强制保证</li> <li>也可以通过工厂模式、IOC 容器（比如 Spring IOC 容器）来保证</li> <li>还可以通过程序员自己来保证（自己在编写代码的时候自己保证不要创建两个类对象）</li></ul></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><div class="edit-link"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon edit-icon"><path d="M117.953 696.992 64.306 959.696l265.931-49.336 450.204-452.505-212.284-213.376-450.204 452.513zm496.384-296.326L219.039 797.993l-46.108-46.34L568.233 354.33l46.104 46.335zm345.357-122.99-114.45 115.04-212.288-213.377 114.45-115.035 212.288 213.371zm0 0" fill="currentColor"></path></svg> <a href="https://github.com/niexia/reading-notes/edit/main/docs/the-beauty-of-design-patterns/design-patterns/create-type/singleton-design-pattern.md" target="_blank" rel="noopener noreferrer">Edit this page</a></div> <div class="meta-item update-time"><span class="label">Last update:</span> <span class="info">June 5, 2022 00:50</span></div> <div class="meta-item contributors"><span class="label">Contributors: </span> <span class="info"><span title="email: yangjin.im@bytedance.com" class="contributor">
          杨金
        </span> <!----></span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/reading-notes/the-beauty-of-design-patterns/standard-refactor/practice/" class="prev"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon prev-icon"><path d="M906.783 588.79c-.02 8.499-6.882 15.36-15.38 15.37l-443.7-.01 75.704 191.682c2.52 6.42.482 13.763-5.038 17.91-5.52 4.168-13.138 4.147-18.616-.092L123.228 524.175a15.362 15.362 0 0 1-6-12.165c0-4.782 2.222-9.277 6-12.185L499.753 210.35a15.388 15.388 0 0 1 9.38-3.195c3.236 0 6.502 1.034 9.236 3.103 5.52 4.147 7.578 11.49 5.038 17.91L447.683 419.84l443.72-.01c8.498.01 15.36 6.881 15.36 15.36l.02 153.6z" fill="currentColor"></path></svg>
        /the-beauty-of-design-patterns/standard-refactor/practice/
      </a></span> <span class="next"><a href="/reading-notes/the-beauty-of-design-patterns/design-patterns/create-type/factory-design-pattern/">
        工厂模式
        <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon next-icon"><path d="M906.772 512c0 4.772-2.211 9.267-5.99 12.175L524.257 813.66a15.37 15.37 0 0 1-18.616.092 15.368 15.368 0 0 1-5.038-17.91l75.714-191.672h-443.73c-8.488 0-15.36-6.881-15.36-15.36v-153.6c0-8.489 6.872-15.36 15.36-15.36h443.73l-75.714-191.682a15.358 15.358 0 0 1 5.048-17.91c5.51-4.158 13.128-4.137 18.606.092l376.525 289.485a15.323 15.323 0 0 1 5.99 12.165z" fill="currentColor"></path></svg></a></span></p></div> <!----> <!----> <div class="content__page-bottom"></div></main> <!----></div><div class="global-ui"><!----><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="Close" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. </p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>Description</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        Install <span></span></button> <button class="cancel-button">
        Cancel
      </button></div></div></div></div><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button class="pswp__button pswp__button--close"></button> <button class="pswp__button pswp__button--share"></button> <button class="pswp__button pswp__button--fs"></button> <button class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button class="pswp__button pswp__button--arrow--left"></button> <button class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div><!----><!----></div></div>
    <script src="/reading-notes/assets/js/app.3d0c3830.js" defer></script><script src="/reading-notes/assets/js/vendors~layout-Layout.3c40cc25.js" defer></script><script src="/reading-notes/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.9b90199b.js" defer></script><script src="/reading-notes/assets/js/page-单例模式.6f5c4f9a.js" defer></script><script src="/reading-notes/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.c1acbf4e.js" defer></script>
  </body>
</html>
